{"ast":null,"code":"import React,{useState,useEffect,useRef}from'react';import{initializeApp}from'firebase/app';import{getAuth,signInAnonymously,signInWithCustomToken,onAuthStateChanged}from'firebase/auth';import{getFirestore,doc,setDoc,getDoc,collection,query,onSnapshot,serverTimestamp,addDoc,getDocs,deleteDoc,where,runTransaction}from'firebase/firestore';// ====================================================================\n// Firebase configuration information - 수정 금지\nimport{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const defaultFirebaseConfig={apiKey:\"AIzaSyBNJtmpRWzjobrY556bnHkwbZmpFJqgPX8\",authDomain:\"text-adventure-game-cb731.firebaseapp.com\",projectId:\"text-adventure-game-cb731\",storageBucket:\"text-adventure-game-cb731.appspot.com\",messagingSenderId:\"1092941614820\",appId:\"1:1092941614820:web:5545f36014b73c268026f1\",measurementId:\"G-FNGF42T1FP\"};// 수정금지\nconst firebaseConfig=defaultFirebaseConfig;const appId=firebaseConfig.projectId;const initialAuthToken=null;// ====================================================================\nconst professions={'1':{name:'몰락한 귀족/기사',motivation:'가문의 몰락 원인을 조사하고, 잃어버린 가문의 보물을 찾아야 합니다.'},'2':{name:'평범한 마을 사람/농부',motivation:'갑자기 마을에 나타난 괴생명체로부터 마을을 지켜야 합니다.'},'3':{name:'젊은 마법사/견습생',motivation:'스승님의 실종에 대한 단서를 찾아야 합니다.'},'4':{name:'용병/모험가',motivation:'의뢰받은 임무를 수행하던 중 예상치 못한 사건에 휘말렸습니다.'},'5':{name:'도적/암살자',motivation:'길드에서 내려온 첫 번째 임무를 완수하고, 그 과정에서 수상한 음모를 감지해야 합니다.'},'6':{name:'왕족/공주/왕자',motivation:'왕실 내의 불화와 암투 속에서 자신의 입지를 다져야 합니다.'}};// Firestore 경로 유틸\nconst getMainScenarioRef=(db,appId)=>doc(db,'artifacts',appId,'public','data','mainScenario','main');const getPrivatePlayerStateRef=(db,appId,userId)=>doc(db,'artifacts',appId,'users',userId,'playerState','state');// 상태 초기화 유틸\nconst getDefaultGameState=()=>({phase:'characterSelection',log:[\"환영합니다! 당신은 중세 유럽풍 판타지 왕국의 모험가가 될 것입니다. 당신은 지금 '방랑자의 안식처'라는 아늑한 여관에 도착했습니다.\",\"어떤 직업을 선택하시겠습니까?\"],choices:Object.keys(professions).map(key=>`${key}. ${professions[key].name}`),player:{// 공유 정보나 기본 UI 표시용\nprofession:'',currentLocation:'방랑자의 안식처'}});const getDefaultPrivatePlayerState=()=>({stats:{strength:10,intelligence:10,agility:10,charisma:10},inventory:[],initialMotivation:'',reputation:{},activeQuests:[],companions:[],knownClues:[]// 개인적으로 알고 있는 단서\n});function App(){const[gameState,setGameState]=useState(getDefaultGameState());const[privatePlayerState,setPrivatePlayerState]=useState(getDefaultPrivatePlayerState());const[isTextLoading,setIsTextLoading]=useState(false);const[activeUsers,setActiveUsers]=useState([]);const[chatMessages,setChatMessages]=useState([]);const[currentChatMessage,setCurrentChatMessage]=useState('');const[actingPlayer,setActingPlayer]=useState(null);const[isActionInProgress,setIsActionInProgress]=useState(false);const[db,setDb]=useState(null);const[auth,setAuth]=useState(null);const[userId,setUserId]=useState(null);const[isAuthReady,setIsAuthReady]=useState(false);const logEndRef=useRef(null);const chatEndRef=useRef(null);const[nickname,setNickname]=useState(()=>localStorage.getItem('nickname')||'');const[showNicknameModal,setShowNicknameModal]=useState(!localStorage.getItem('nickname'));const[nicknameInput,setNicknameInput]=useState('');const[accordion,setAccordion]=useState({gameLog:true,chat:true,users:true,playerInfo:true});const[showResetModal,setShowResetModal]=useState(false);const[isResetting,setIsResetting]=useState(false);const[llmError,setLlmError]=useState(null);const[llmRetryPrompt,setLlmRetryPrompt]=useState(null);const handleNicknameSubmit=()=>{if(nicknameInput.trim()){const finalNickname=nicknameInput.trim();setNickname(finalNickname);localStorage.setItem('nickname',finalNickname);setShowNicknameModal(false);if(userId&&db){const userDocRef=doc(db,'artifacts',appId,'public','data','activeUsers',userId);setDoc(userDocRef,{nickname:finalNickname},{merge:true});}}};const getDisplayName=uid=>{if(uid===userId)return nickname||`플레이어 ${userId===null||userId===void 0?void 0:userId.substring(0,4)}`;const user=activeUsers.find(u=>u.id===uid);return(user===null||user===void 0?void 0:user.nickname)||`플레이어 ${uid===null||uid===void 0?void 0:uid.substring(0,4)}`;};const resetAllGameData=async()=>{if(!db||!isAuthReady)return;setIsResetting(true);try{const collectionsToDelete=[collection(db,'artifacts',appId,'public','data','chatMessages'),collection(db,'artifacts',appId,'public','data','activeUsers')];for(const colRef of collectionsToDelete){const snapshot=await getDocs(colRef);for(const docSnap of snapshot.docs){await deleteDoc(docSnap.ref);}}const usersColRef=collection(db,'artifacts',appId,'users');const usersSnapshot=await getDocs(usersColRef);for(const userDoc of usersSnapshot.docs){const playerStateColRef=collection(db,'artifacts',appId,'users',userDoc.id,'playerState');const playerStateSnapshot=await getDocs(playerStateColRef);for(const stateDoc of playerStateSnapshot.docs){await deleteDoc(stateDoc.ref);}}const mainScenarioRef=getMainScenarioRef(db,appId);await setDoc(mainScenarioRef,{...getDefaultGameState(),storyLog:getDefaultGameState().log,lastUpdate:serverTimestamp()});const gameStatusRef=doc(db,'artifacts',appId,'public','data','gameStatus','status');await deleteDoc(gameStatusRef);setGameState(getDefaultGameState());setPrivatePlayerState(getDefaultPrivatePlayerState());setChatMessages([]);}catch(e){setGameState(prev=>({...prev,log:[...prev.log,'데이터 초기화 중 오류 발생: '+e.message]}));}finally{setIsResetting(false);setShowResetModal(false);}};useEffect(()=>{try{const app=initializeApp(firebaseConfig);const firestoreDb=getFirestore(app);const firebaseAuth=getAuth(app);setDb(firestoreDb);setAuth(firebaseAuth);const unsubscribeAuth=onAuthStateChanged(firebaseAuth,async user=>{if(user){setUserId(user.uid);setIsAuthReady(true);}else{await(initialAuthToken?signInWithCustomToken(firebaseAuth,initialAuthToken):signInAnonymously(firebaseAuth));}});return()=>unsubscribeAuth();}catch(error){console.error(\"Firebase initialization error:\",error);}},[]);useEffect(()=>{if(!db||!userId||!isAuthReady)return;const privateStateRef=getPrivatePlayerStateRef(db,appId,userId);const unsubscribe=onSnapshot(privateStateRef,docSnap=>{if(docSnap.exists()){setPrivatePlayerState(docSnap.data());}else{setDoc(privateStateRef,getDefaultPrivatePlayerState());}},error=>{console.error(\"Private player state snapshot error:\",error);});return()=>unsubscribe();},[db,userId,isAuthReady]);useEffect(()=>{if(!db||!isAuthReady||!userId||!auth)return;const gameStatusDocRef=doc(db,'artifacts',appId,'public','data','gameStatus','status');const unsubscribeGameStatus=onSnapshot(gameStatusDocRef,docSnap=>{const data=docSnap.data();setIsActionInProgress((data===null||data===void 0?void 0:data.isActionInProgress)||false);setActingPlayer((data===null||data===void 0?void 0:data.actingPlayer)||null);});const chatMessagesColRef=collection(db,'artifacts',appId,'public','data','chatMessages');const unsubscribeChat=onSnapshot(query(chatMessagesColRef),snapshot=>{const messages=snapshot.docs.map(doc=>({id:doc.id,...doc.data()})).sort((a,b)=>{var _a$timestamp,_b$timestamp;return(((_a$timestamp=a.timestamp)===null||_a$timestamp===void 0?void 0:_a$timestamp.toMillis())||0)-(((_b$timestamp=b.timestamp)===null||_b$timestamp===void 0?void 0:_b$timestamp.toMillis())||0);});setChatMessages(messages);});const activeUsersColRef=collection(db,'artifacts',appId,'public','data','activeUsers');const unsubscribeActiveUsers=onSnapshot(query(activeUsersColRef),snapshot=>{const cutoffTime=Date.now()-60*1000;const users=snapshot.docs.map(doc=>({id:doc.id,...doc.data()})).filter(user=>user.lastActive&&user.lastActive.toMillis()>cutoffTime);setActiveUsers(users);});const updateUserPresence=async()=>{if(userId){const userDocRef=doc(db,'artifacts',appId,'public','data','activeUsers',userId);await setDoc(userDocRef,{lastActive:serverTimestamp(),nickname:nickname||`플레이어 ${userId.substring(0,4)}`,profession:gameState.player.profession},{merge:true});}};updateUserPresence();const presenceInterval=setInterval(updateUserPresence,30000);return()=>{unsubscribeGameStatus();unsubscribeChat();unsubscribeActiveUsers();clearInterval(presenceInterval);};},[db,isAuthReady,userId,auth,nickname,gameState.player.profession]);useEffect(()=>{if(accordion.gameLog&&logEndRef.current)logEndRef.current.scrollIntoView({behavior:\"smooth\"});},[gameState.log,accordion.gameLog]);useEffect(()=>{if(accordion.chat&&chatEndRef.current)chatEndRef.current.scrollIntoView({behavior:\"smooth\"});},[chatMessages,accordion.chat]);// ====================================================================\n// LLM PROMPT ENGINEERING SECTION\n// ====================================================================\nconst systemPrompt=`\n    ### 페르소나 (Persona)\n    당신은 TRPG(Tabletop Role-Playing Game)의 최고 실력자 '게임 마스터(GM)'입니다. 당신의 임무는 단순한 스토리 생성이 아니라, 각 플레이어가 자신의 서사의 주인공이 되면서도, 모두가 하나의 거대한 세계관 속에서 살아 숨 쉬고 있다는 느낌을 받도록 만드는 것입니다. 당신은 유려한 문장가이자, 치밀한 설계자이며, 플레이어들의 행동에 즉각적으로 반응하는 유연한 스토리텔러입니다.\n\n    ### 핵심 철학: 하이브리드 월드 (Hybrid World)\n    이 세계는 '공유된 현실'과 '개인적인 서사'가 공존합니다.\n    1.  **공유된 현실 (Shared Reality):** 세상의 중요한 사건, 장소의 변화, 주요 NPC의 죽음 등은 모든 플레이어가 함께 경험하는 절대적인 현실입니다. 이는 'story'와 'sharedStateUpdates'로 표현됩니다.\n    2.  **개인적인 서사 (Personal Narrative):** 플레이어의 내면의 생각, 남들은 모르는 비밀 지식, 개인적인 퀘스트의 진행 등은 오직 그 플레이어에게만 주어지는 고유한 경험입니다. 이는 'privateStory', 'privateChoices', 'privateStateUpdates'로 표현됩니다.\n\n    ### 스토리텔링 원칙\n    * **보여주되, 말하지 말라 (Show, Don't Tell):** '그는 화가 났다'가 아니라 '그는 주먹을 불끈 쥐었다'라고 묘사하십시오.\n    * **역할 존중:** 플레이어의 직업, 능력치, 아이템, 그리고 특히 **'[개인 정보]'**에 담긴 단서('knownClues')나 퀘스트('activeQuests')는 당신이 스토리를 만들 때 가장 먼저 고려해야 할 재료입니다. 이것이 개인화된 경험의 핵심입니다.\n    * **살아있는 세계:** '[주변 플레이어]' 정보를 활용하여 다른 플레이어들의 존재를 이야기에 자연스럽게 녹여내십시오. 그들의 등장은 단순한 배경이 아니라, 새로운 사건의 계기가 되어야 합니다.\n    * **선택의 무게:** 플레이어의 선택은 반드시 의미 있는 결과를 가져와야 합니다. 사소한 선택이 나비효과를 일으킬 수도 있습니다.\n\n    ### JSON 출력 규칙 (매우 중요)\n    당신은 반드시 아래의 JSON 구조를 완벽하게 따라야 합니다. 설명(comment)은 절대 포함하지 마십시오.\n    {\n      \"story\": \"모든 플레이어가 볼 수 있는 공유된 사건에 대한 3인칭 서사. 이 사건의 결과로 세상이 어떻게 변했는지 객관적으로 묘사합니다.\",\n      \"privateStory\": \"선택을 한 플레이어만 볼 수 있는 2인칭 서사. '당신은...', '...라고 느낀다.' 와 같이 내면의 생각, 감각, 남들이 눈치채지 못한 미세한 발견 등을 묘사합니다.\",\n      \"choices\": [\n        \"다른 플레이어들도 선택할 수 있는 일반적인 행동들.\"\n      ],\n      \"privateChoices\": [\n        \"오직 이 플레이어의 직업, 아이템, 퀘스트, 단서 때문에 가능한 특별한 행동들.\"\n      ],\n      \"sharedStateUpdates\": {\n        \"location\": \"플레이어 그룹의 현재 위치. 변경되었을 경우에만 포함됩니다.\"\n      },\n      \"privateStateUpdates\": {\n        \"inventory\": [\"업데이트된 전체 인벤토리 목록\"],\n        \"stats\": {\"strength\": 12, \"intelligence\": 10, ...},\n        \"activeQuests\": [\"업데이트된 개인 퀘스트 목록\"],\n        \"knownClues\": [\"새롭게 알게 된 단서를 포함한 전체 단서 목록\"],\n        \"companions\": [\"업데이트된 동료 목록\"],\n        \"reputation\": {\"세력명\": \"상태\", ...}\n      }\n    }\n\n    ### 규칙 상세\n    * 'privateChoices' 예시: 플레이어의 'knownClues'에 '가문의 문장'이 있다면, \"가문의 문장을 제단에 맞춰본다.\" 와 같은 선택지를 제공하십시오.\n    * **상태 업데이트:** 'privateStateUpdates'의 모든 필드는 **변경 여부와 관계없이 항상 현재 플레이어의 전체 상태를 포함**하여 보내야 합니다. 예를 들어, 아이템을 하나 얻었다면, 기존 아이템을 포함한 전체 인벤토리 목록을 'inventory'에 담아야 합니다.\n    * 'story'와 'privateStory'는 합쳐서 500자 이내로 간결하게 작성하십시오.\n  `;const callGeminiTextLLM=async promptData=>{setIsTextLoading(true);setLlmRetryPrompt(promptData);const mainApiKey=\"AIzaSyDC11rqjU30OJnLjaBFOaazZV0klM5raU8\";// This will be provided by the Canvas environment.\nconst backupApiKey=\"AIzaSyAhscNjW8GmwKPuKzQ47blCY_bDanR\";// This will be provided by the Canvas environment.\nconst getApiUrl=apiKey=>`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;// LLM이 상황을 명확하게 파악하도록 구조화된 User Prompt\nconst userPrompt=`\n      [상황 분석 요청]\n      아래 정보를 바탕으로 플레이어의 행동에 대한 결과를 생성해주십시오.\n\n      [공유 컨텍스트]\n      - 현재 위치: ${promptData.sharedInfo.currentLocation}\n      - 이전 주요 사건 로그 (최대 5개): ${JSON.stringify(promptData.history.slice(-5))}\n\n      [개인 정보 (현재 플레이어)]\n      - 직업: ${promptData.privateInfo.profession||gameState.player.profession}\n      - 능력치: ${JSON.stringify(promptData.privateInfo.stats)}\n      - 인벤토리: ${JSON.stringify(promptData.privateInfo.inventory)}\n      - 활성 퀘스트: ${JSON.stringify(promptData.privateInfo.activeQuests)}\n      - 알려진 단서: ${JSON.stringify(promptData.privateInfo.knownClues)}\n      - 평판: ${JSON.stringify(promptData.privateInfo.reputation)}\n\n      [플레이어의 행동]\n      - 선택: \"${promptData.playerChoice}\"\n\n      [주변 플레이어]\n      - ${promptData.activeUsers.length>0?JSON.stringify(promptData.activeUsers):\"현재 주변에 다른 플레이어가 없습니다.\"}\n    `;const payload={contents:[{role:\"user\",parts:[{text:systemPrompt}]},{role:\"model\",parts:[{text:\"{}\"}]},{role:\"user\",parts:[{text:userPrompt}]}]};const tryGeminiCall=async apiKey=>fetch(getApiUrl(apiKey),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});try{var _result$candidates,_result$candidates$,_result$candidates$$c,_result$candidates$$c2,_result$candidates$$c3;let response=await tryGeminiCall(mainApiKey);if(!response.ok){response=await tryGeminiCall(backupApiKey);}if(!response.ok){throw new Error(`HTTP error! status: ${response.status}`);}const result=await response.json();const llmOutputText=(_result$candidates=result.candidates)===null||_result$candidates===void 0?void 0:(_result$candidates$=_result$candidates[0])===null||_result$candidates$===void 0?void 0:(_result$candidates$$c=_result$candidates$.content)===null||_result$candidates$$c===void 0?void 0:(_result$candidates$$c2=_result$candidates$$c.parts)===null||_result$candidates$$c2===void 0?void 0:(_result$candidates$$c3=_result$candidates$$c2[0])===null||_result$candidates$$c3===void 0?void 0:_result$candidates$$c3.text;const jsonMatch=llmOutputText===null||llmOutputText===void 0?void 0:llmOutputText.match(/\\{[\\s\\S]*\\}/);if(jsonMatch)return JSON.parse(jsonMatch[0]);throw new Error(\"Valid JSON object not found in LLM response.\");}catch(error){console.error(\"LLM API call error:\",error);setLlmError(error.message||'LLM 호출 실패');return null;}finally{setIsTextLoading(false);}};// ====================================================================\n// END OF LLM PROMPT ENGINEERING SECTION\n// ====================================================================\nconst sendChatMessage=async()=>{if(!db||!userId||!isAuthReady||!currentChatMessage.trim())return;try{const chatCollectionRef=collection(db,'artifacts',appId,'public','data','chatMessages');await addDoc(chatCollectionRef,{userId,displayName:getDisplayName(userId),message:currentChatMessage,timestamp:serverTimestamp()});setCurrentChatMessage('');}catch(error){console.error(\"Error sending chat message:\",error);}};// *** 권한 오류 수정을 위해 isAuthReady를 의존성에 추가하고 로직을 수정 ***\nuseEffect(()=>{if(!db||!appId||!isAuthReady)return;// 인증이 준비될 때까지 대기\nconst ref=getMainScenarioRef(db,appId);const unsubscribe=onSnapshot(ref,async snap=>{if(snap.exists()){const data=snap.data();setGameState(prev=>{var _data$player;return{...prev,log:data.storyLog||prev.log,choices:data.choices||[],phase:data.phase||prev.phase,player:{...prev.player,currentLocation:((_data$player=data.player)===null||_data$player===void 0?void 0:_data$player.currentLocation)||prev.player.currentLocation}};});}else{// 최초 시나리오 생성\nconst def=getDefaultGameState();try{await setDoc(ref,{...def,storyLog:def.log,lastUpdate:serverTimestamp()},{merge:true});setGameState(def);}catch(e){console.error(\"Failed to create initial scenario:\",e);}}},error=>{console.error(\"Main scenario snapshot error:\",error);setLlmError(\"시나리오를 불러오는 중 오류가 발생했습니다. 페이지를 새로고침 해보세요.\");});return()=>unsubscribe();},[db,appId,isAuthReady]);// isAuthReady를 의존성 배열에 추가\nconst updateGameStateFromLLM=async llmResponse=>{if(!db||!appId||!userId)return;const mainScenarioRef=getMainScenarioRef(db,appId);const newChoices=[...(llmResponse.choices||[]),...(llmResponse.privateChoices||[])];try{await runTransaction(db,async transaction=>{var _llmResponse$sharedSt;const scenarioDoc=await transaction.get(mainScenarioRef);if(!scenarioDoc.exists())throw\"시나리오 문서가 존재하지 않습니다.\";const currentData=scenarioDoc.data();// 트랜잭션에서는 공유 로그만 업데이트\nconst publicLog=[...(currentData.storyLog||[]),llmResponse.story];transaction.update(mainScenarioRef,{storyLog:publicLog,choices:newChoices,phase:'playing','player.currentLocation':((_llmResponse$sharedSt=llmResponse.sharedStateUpdates)===null||_llmResponse$sharedSt===void 0?void 0:_llmResponse$sharedSt.location)||currentData.player.currentLocation,lastUpdate:serverTimestamp(),lastActor:{id:userId,displayName:getDisplayName(userId)}});});// 트랜잭션 성공 후, 로컬 상태에만 개인 스토리 추가\n// onSnapshot이 비동기적으로 작동하므로, 즉각적인 UI 반영을 위해 로컬 상태를 직접 조작\nconst docSnap=await getDoc(mainScenarioRef);const updatedPublicLog=docSnap.data().storyLog;const finalLog=llmResponse.privateStory?[...updatedPublicLog,`\\n[당신만 아는 사실] ${llmResponse.privateStory}`]:[...updatedPublicLog];setGameState(prev=>({...prev,log:finalLog,choices:newChoices}));}catch(error){console.error(\"공유 상태 업데이트 실패:\",error);setLlmError(\"시나리오를 업데이트하는 데 실패했습니다.\");}const privateStateRef=getPrivatePlayerStateRef(db,appId,userId);if(llmResponse.privateStateUpdates){await setDoc(privateStateRef,llmResponse.privateStateUpdates,{merge:false});}};const handleChoiceClick=async choice=>{if(isTextLoading||isActionInProgress)return;const gameStatusRef=doc(db,'artifacts',appId,'public','data','gameStatus','status');try{await runTransaction(db,async transaction=>{const statusDoc=await transaction.get(gameStatusRef);if(statusDoc.exists()&&statusDoc.data().isActionInProgress){throw new Error(\"다른 플레이어가 행동 중입니다. 잠시 후 다시 시도해주세요.\");}transaction.set(gameStatusRef,{isActionInProgress:true,actingPlayer:{id:userId,displayName:getDisplayName(userId)}},{merge:true});});const newLog=[...gameState.log,`\\n> ${choice}`];setGameState(prev=>({...prev,log:newLog}));if(gameState.phase==='characterSelection'){const choiceKey=choice.split('.')[0];const selectedProfession=professions[choiceKey];if(selectedProfession){const initialMotivation=selectedProfession.motivation;const finalLog=[...newLog,`\\n당신은 '${selectedProfession.name}'입니다. ${initialMotivation}`];const choices=[\"여관을 둘러본다.\",\"다른 모험가에게 말을 건다.\",\"여관 주인에게 정보를 묻는다.\"];const mainScenarioRef=getMainScenarioRef(db,appId);await setDoc(mainScenarioRef,{phase:'playing',storyLog:finalLog,choices:choices,lastUpdate:serverTimestamp(),lastActor:{id:userId,displayName:getDisplayName(userId)}},{merge:true});const privateStateRef=getPrivatePlayerStateRef(db,appId,userId);const newPrivateState=getDefaultPrivatePlayerState();newPrivateState.initialMotivation=initialMotivation;await setDoc(privateStateRef,newPrivateState,{merge:true});setGameState(prev=>({...prev,player:{...prev.player,profession:selectedProfession.name}}));return;}}const promptData={playerChoice:choice,sharedInfo:{currentLocation:gameState.player.currentLocation},privateInfo:{...privatePlayerState,profession:gameState.player.profession// privateInfo에 직업 정보 추가\n},history:newLog,activeUsers:activeUsers.map(u=>({nickname:getDisplayName(u.id),profession:u.profession})).filter(u=>u.id!==userId)};const llmResponse=await callGeminiTextLLM(promptData);if(llmResponse){await updateGameStateFromLLM(llmResponse);setLlmError(null);}else{throw new Error(\"LLM으로부터 유효한 응답을 받지 못했습니다.\");}}catch(error){console.error(\"행동 처리 중 오류:\",error.message);setLlmError(error.message);}finally{await setDoc(gameStatusRef,{isActionInProgress:false,actingPlayer:null},{merge:true});setIsTextLoading(false);}};const toggleAccordion=key=>{setAccordion(prev=>({...prev,[key]:!prev[key]}));};return/*#__PURE__*/_jsxs(\"div\",{className:\"min-h-screen bg-gray-900 text-gray-100 flex flex-col items-center justify-center p-4 font-sans\",children:[showNicknameModal&&/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-md space-y-4\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-xl font-bold text-gray-100\",children:\"\\uB2C9\\uB124\\uC784\\uC744 \\uC785\\uB825\\uD558\\uC138\\uC694\"}),/*#__PURE__*/_jsx(\"input\",{className:\"w-full p-3 rounded-md bg-gray-700 border border-gray-600 text-gray-100 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 text-lg\",placeholder:\"\\uB2C9\\uB124\\uC784\",value:nicknameInput,onChange:e=>setNicknameInput(e.target.value),onKeyDown:e=>{if(e.key==='Enter')handleNicknameSubmit();},autoFocus:true}),/*#__PURE__*/_jsx(\"button\",{className:\"w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-md transition duration-300 disabled:opacity-50\",onClick:handleNicknameSubmit,disabled:!nicknameInput.trim(),children:\"\\uC2DC\\uC791\\uD558\\uAE30\"})]})}),showResetModal&&/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-md space-y-4\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-xl font-bold text-red-400\",children:\"\\u26A0\\uFE0F \\uBAA8\\uB4E0 \\uB370\\uC774\\uD130\\uB97C \\uCD08\\uAE30\\uD654\\uD560\\uAE4C\\uC694?\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-200\",children:\"\\uC774 \\uC791\\uC5C5\\uC740 \\uB418\\uB3CC\\uB9B4 \\uC218 \\uC5C6\\uC2B5\\uB2C8\\uB2E4. \\uBAA8\\uB4E0 \\uC2DC\\uB098\\uB9AC\\uC624, \\uB85C\\uADF8, \\uC720\\uC800, \\uCC44\\uD305 \\uB370\\uC774\\uD130\\uAC00 \\uC0AD\\uC81C\\uB429\\uB2C8\\uB2E4.\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-end gap-3\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"px-4 py-2 bg-gray-600 hover:bg-gray-700 font-bold rounded-md\",onClick:()=>setShowResetModal(false),disabled:isResetting,children:\"\\uCDE8\\uC18C\"}),/*#__PURE__*/_jsx(\"button\",{className:\"px-4 py-2 bg-red-600 hover:bg-red-700 font-bold rounded-md\",onClick:resetAllGameData,disabled:isResetting,children:isResetting?'초기화 중...':'초기화'})]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"w-full max-w-5xl bg-gray-800 rounded-lg shadow-xl p-6 md:p-8 flex flex-col lg:flex-row space-y-6 lg:space-y-0 lg:space-x-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col w-full lg:w-2/3 space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-2\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between cursor-pointer select-none\",onClick:()=>toggleAccordion('gameLog'),children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-lg font-bold text-gray-100\",children:\"\\uAC8C\\uC784 \\uB85C\\uADF8\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xl\",children:accordion.gameLog?'▼':'▲'})]}),accordion.gameLog&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-end mb-2\",children:/*#__PURE__*/_jsx(\"button\",{className:\"px-3 py-1 bg-red-600 hover:bg-red-700 text-white text-xs rounded-md\",onClick:()=>setShowResetModal(true),children:\"\\uC804\\uCCB4 \\uB370\\uC774\\uD130 \\uCD08\\uAE30\\uD654\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-grow bg-gray-700 p-4 rounded-md overflow-y-auto h-96 custom-scrollbar text-sm md:text-base leading-relaxed\",style:{maxHeight:'24rem'},children:[gameState.log.map((line,index)=>/*#__PURE__*/_jsx(\"p\",{className:\"whitespace-pre-wrap mb-1\",dangerouslySetInnerHTML:{__html:line.replace(/\\n/g,'<br />')}},index)),isTextLoading&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-center items-center mt-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-300\"}),/*#__PURE__*/_jsx(\"span\",{className:\"ml-3 text-gray-400\",children:\"\\uC774\\uC57C\\uAE30\\uB97C \\uC0DD\\uC131 \\uC911...\"})]}),isActionInProgress&&(!actingPlayer||actingPlayer.id!==userId)&&/*#__PURE__*/_jsx(\"div\",{className:\"text-center text-yellow-400 font-semibold p-2 bg-black bg-opacity-20 rounded-md mt-2\",children:actingPlayer?`${getDisplayName(actingPlayer.id)}님이 선택하고 있습니다...`:\"다른 플레이어가 선택하고 있습니다...\"}),llmError&&/*#__PURE__*/_jsxs(\"div\",{className:\"text-red-400 p-2 bg-red-900 bg-opacity-50 rounded mt-2\",children:[\"\\uC624\\uB958: \",llmError]}),/*#__PURE__*/_jsx(\"div\",{ref:logEndRef})]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex flex-col gap-3\",children:gameState.choices.map((choice,index)=>/*#__PURE__*/_jsx(\"button\",{className:\"px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-md shadow-lg transition duration-300 disabled:opacity-50 disabled:cursor-not-allowed\",onClick:()=>handleChoiceClick(choice),disabled:isTextLoading||isActionInProgress,children:choice},index))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"w-full lg:w-1/3 flex flex-col space-y-6 bg-gray-700 p-4 rounded-lg shadow-inner\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-2\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between cursor-pointer select-none\",onClick:()=>toggleAccordion('playerInfo'),children:[/*#__PURE__*/_jsx(\"h4\",{className:\"text-md font-semibold text-gray-200\",children:\"\\uB0B4 \\uC815\\uBCF4\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xl\",children:accordion.playerInfo?'▼':'▲'})]}),accordion.playerInfo&&gameState.phase==='playing'&&/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gray-600 p-3 rounded-md text-xs md:text-sm text-gray-300 space-y-1 h-48 overflow-y-auto custom-scrollbar\",children:[/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold text-blue-300\",children:\"\\uC9C1\\uC5C5:\"}),\" \",gameState.player.profession]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold text-blue-300\",children:\"\\uC704\\uCE58:\"}),\" \",gameState.player.currentLocation]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold text-blue-300\",children:\"\\uB2A5\\uB825\\uCE58:\"}),\" \\uD798(\",privatePlayerState.stats.strength,\") \\uC9C0\\uB2A5(\",privatePlayerState.stats.intelligence,\") \\uBBFC\\uCCA9(\",privatePlayerState.stats.agility,\") \\uCE74\\uB9AC\\uC2A4\\uB9C8(\",privatePlayerState.stats.charisma,\")\"]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold text-blue-300\",children:\"\\uC778\\uBCA4\\uD1A0\\uB9AC:\"}),\" \",privatePlayerState.inventory.join(', ')||'비어있음']}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold text-blue-300\",children:\"\\uD018\\uC2A4\\uD2B8:\"}),\" \",privatePlayerState.activeQuests.join(', ')||'없음']}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold text-blue-300\",children:\"\\uB2E8\\uC11C:\"}),\" \",privatePlayerState.knownClues.join(', ')||'없음']})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-2\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between cursor-pointer select-none\",onClick:()=>toggleAccordion('users'),children:[/*#__PURE__*/_jsx(\"h4\",{className:\"text-md font-semibold text-gray-200\",children:\"\\uD604\\uC7AC \\uD50C\\uB808\\uC774\\uC5B4\\uB4E4\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xl\",children:accordion.users?'▼':'▲'})]}),accordion.users&&/*#__PURE__*/_jsx(\"div\",{className:\"bg-gray-600 p-3 rounded-md h-48 overflow-y-auto custom-scrollbar\",children:activeUsers.length>0?/*#__PURE__*/_jsx(\"ul\",{className:\"text-sm text-gray-300 space-y-1\",children:activeUsers.map(user=>/*#__PURE__*/_jsxs(\"li\",{className:\"truncate p-1 rounded-md\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium text-green-300\",children:getDisplayName(user.id)}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-gray-400 text-xs\",children:[\" (\",user.profession||'모험가',\")\"]})]},user.id))}):/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-400\",children:\"\\uD65C\\uB3D9 \\uC911\\uC778 \\uD50C\\uB808\\uC774\\uC5B4\\uAC00 \\uC5C6\\uC2B5\\uB2C8\\uB2E4.\"})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-2\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between cursor-pointer select-none\",onClick:()=>toggleAccordion('chat'),children:[/*#__PURE__*/_jsx(\"h4\",{className:\"text-md font-semibold text-gray-200\",children:\"\\uACF5\\uAC1C \\uCC44\\uD305\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xl\",children:accordion.chat?'▼':'▲'})]}),accordion.chat&&/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gray-600 p-3 rounded-md flex flex-col h-64\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex-grow overflow-y-auto custom-scrollbar mb-3 text-sm space-y-2\",children:[chatMessages.map(msg=>/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsxs(\"span\",{className:\"font-medium text-yellow-300\",children:[getDisplayName(msg.userId),\":\"]}),\" \",msg.message]})},msg.id)),/*#__PURE__*/_jsx(\"div\",{ref:chatEndRef})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"flex-grow p-2 rounded-l-md bg-gray-700 border border-gray-600\",value:currentChatMessage,onChange:e=>setCurrentChatMessage(e.target.value),onKeyPress:e=>e.key==='Enter'&&sendChatMessage(),disabled:!isAuthReady}),/*#__PURE__*/_jsx(\"button\",{className:\"px-4 py-2 bg-blue-600 hover:bg-blue-700 font-bold rounded-r-md\",onClick:sendChatMessage,disabled:!isAuthReady||!currentChatMessage.trim(),children:\"\\uBCF4\\uB0B4\\uAE30\"})]})]})]})]})]}),/*#__PURE__*/_jsx(\"style\",{children:`\n        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap');\n        body { font-family: 'Noto Sans KR', sans-serif; }\n        .custom-scrollbar::-webkit-scrollbar { width: 8px; }\n        .custom-scrollbar::-webkit-scrollbar-track { background: #4a5568; border-radius: 10px; }\n        .custom-scrollbar::-webkit-scrollbar-thumb { background: #6b7280; border-radius: 10px; }\n        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #9ca3af; }\n        `})]});}export default App;","map":{"version":3,"names":["React","useState","useEffect","useRef","initializeApp","getAuth","signInAnonymously","signInWithCustomToken","onAuthStateChanged","getFirestore","doc","setDoc","getDoc","collection","query","onSnapshot","serverTimestamp","addDoc","getDocs","deleteDoc","where","runTransaction","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","defaultFirebaseConfig","apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId","measurementId","firebaseConfig","initialAuthToken","professions","name","motivation","getMainScenarioRef","db","getPrivatePlayerStateRef","userId","getDefaultGameState","phase","log","choices","Object","keys","map","key","player","profession","currentLocation","getDefaultPrivatePlayerState","stats","strength","intelligence","agility","charisma","inventory","initialMotivation","reputation","activeQuests","companions","knownClues","App","gameState","setGameState","privatePlayerState","setPrivatePlayerState","isTextLoading","setIsTextLoading","activeUsers","setActiveUsers","chatMessages","setChatMessages","currentChatMessage","setCurrentChatMessage","actingPlayer","setActingPlayer","isActionInProgress","setIsActionInProgress","setDb","auth","setAuth","setUserId","isAuthReady","setIsAuthReady","logEndRef","chatEndRef","nickname","setNickname","localStorage","getItem","showNicknameModal","setShowNicknameModal","nicknameInput","setNicknameInput","accordion","setAccordion","gameLog","chat","users","playerInfo","showResetModal","setShowResetModal","isResetting","setIsResetting","llmError","setLlmError","llmRetryPrompt","setLlmRetryPrompt","handleNicknameSubmit","trim","finalNickname","setItem","userDocRef","merge","getDisplayName","uid","substring","user","find","u","id","resetAllGameData","collectionsToDelete","colRef","snapshot","docSnap","docs","ref","usersColRef","usersSnapshot","userDoc","playerStateColRef","playerStateSnapshot","stateDoc","mainScenarioRef","storyLog","lastUpdate","gameStatusRef","e","prev","message","app","firestoreDb","firebaseAuth","unsubscribeAuth","error","console","privateStateRef","unsubscribe","exists","data","gameStatusDocRef","unsubscribeGameStatus","chatMessagesColRef","unsubscribeChat","messages","sort","a","b","_a$timestamp","_b$timestamp","timestamp","toMillis","activeUsersColRef","unsubscribeActiveUsers","cutoffTime","Date","now","filter","lastActive","updateUserPresence","presenceInterval","setInterval","clearInterval","current","scrollIntoView","behavior","systemPrompt","callGeminiTextLLM","promptData","mainApiKey","backupApiKey","getApiUrl","userPrompt","sharedInfo","JSON","stringify","history","slice","privateInfo","playerChoice","length","payload","contents","role","parts","text","tryGeminiCall","fetch","method","headers","body","_result$candidates","_result$candidates$","_result$candidates$$c","_result$candidates$$c2","_result$candidates$$c3","response","ok","Error","status","result","json","llmOutputText","candidates","content","jsonMatch","match","parse","sendChatMessage","chatCollectionRef","displayName","snap","_data$player","def","updateGameStateFromLLM","llmResponse","newChoices","privateChoices","transaction","_llmResponse$sharedSt","scenarioDoc","get","currentData","publicLog","story","update","sharedStateUpdates","location","lastActor","updatedPublicLog","finalLog","privateStory","privateStateUpdates","handleChoiceClick","choice","statusDoc","set","newLog","choiceKey","split","selectedProfession","newPrivateState","toggleAccordion","className","children","placeholder","value","onChange","target","onKeyDown","autoFocus","onClick","disabled","style","maxHeight","line","index","dangerouslySetInnerHTML","__html","replace","join","msg","type","onKeyPress"],"sources":["C:/workspaces/gemini/src/App.jsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport { initializeApp } from 'firebase/app';\r\nimport {\r\n  getAuth,\r\n  signInAnonymously,\r\n  signInWithCustomToken,\r\n  onAuthStateChanged\r\n} from 'firebase/auth';\r\nimport {\r\n  getFirestore,\r\n  doc,\r\n  setDoc,\r\n  getDoc,\r\n  collection,\r\n  query,\r\n  onSnapshot,\r\n  serverTimestamp,\r\n  addDoc,\r\n  getDocs,\r\n  deleteDoc,\r\n  where,\r\n  runTransaction\r\n} from 'firebase/firestore';\r\n\r\n// ====================================================================\r\n// Firebase configuration information - 수정 금지\r\nconst defaultFirebaseConfig = {\r\n  apiKey: \"AIzaSyBNJtmpRWzjobrY556bnHkwbZmpFJqgPX8\",\r\n  authDomain: \"text-adventure-game-cb731.firebaseapp.com\",\r\n  projectId: \"text-adventure-game-cb731\",\r\n  storageBucket: \"text-adventure-game-cb731.appspot.com\",\r\n  messagingSenderId: \"1092941614820\",\r\n  appId: \"1:1092941614820:web:5545f36014b73c268026f1\",\r\n  measurementId: \"G-FNGF42T1FP\"\r\n};\r\n\r\n// 수정금지\r\nconst firebaseConfig = defaultFirebaseConfig;\r\nconst appId = firebaseConfig.projectId;\r\nconst initialAuthToken = null;\r\n// ====================================================================\r\n\r\nconst professions = {\r\n  '1': { name: '몰락한 귀족/기사', motivation: '가문의 몰락 원인을 조사하고, 잃어버린 가문의 보물을 찾아야 합니다.' },\r\n  '2': { name: '평범한 마을 사람/농부', motivation: '갑자기 마을에 나타난 괴생명체로부터 마을을 지켜야 합니다.' },\r\n  '3': { name: '젊은 마법사/견습생', motivation: '스승님의 실종에 대한 단서를 찾아야 합니다.' },\r\n  '4': { name: '용병/모험가', motivation: '의뢰받은 임무를 수행하던 중 예상치 못한 사건에 휘말렸습니다.' },\r\n  '5': { name: '도적/암살자', motivation: '길드에서 내려온 첫 번째 임무를 완수하고, 그 과정에서 수상한 음모를 감지해야 합니다.' },\r\n  '6': { name: '왕족/공주/왕자', motivation: '왕실 내의 불화와 암투 속에서 자신의 입지를 다져야 합니다.' },\r\n};\r\n\r\n// Firestore 경로 유틸\r\nconst getMainScenarioRef = (db, appId) => doc(db, 'artifacts', appId, 'public', 'data', 'mainScenario', 'main');\r\nconst getPrivatePlayerStateRef = (db, appId, userId) => doc(db, 'artifacts', appId, 'users', userId, 'playerState', 'state');\r\n\r\n// 상태 초기화 유틸\r\nconst getDefaultGameState = () => ({\r\n  phase: 'characterSelection',\r\n  log: [\r\n    \"환영합니다! 당신은 중세 유럽풍 판타지 왕국의 모험가가 될 것입니다. 당신은 지금 '방랑자의 안식처'라는 아늑한 여관에 도착했습니다.\",\r\n    \"어떤 직업을 선택하시겠습니까?\"\r\n  ],\r\n  choices: Object.keys(professions).map(key => `${key}. ${professions[key].name}`),\r\n  player: { // 공유 정보나 기본 UI 표시용\r\n    profession: '',\r\n    currentLocation: '방랑자의 안식처',\r\n  },\r\n});\r\n\r\nconst getDefaultPrivatePlayerState = () => ({\r\n    stats: { strength: 10, intelligence: 10, agility: 10, charisma: 10 },\r\n    inventory: [],\r\n    initialMotivation: '',\r\n    reputation: {},\r\n    activeQuests: [],\r\n    companions: [],\r\n    knownClues: [], // 개인적으로 알고 있는 단서\r\n});\r\n\r\n\r\nfunction App() {\r\n  const [gameState, setGameState] = useState(getDefaultGameState());\r\n  const [privatePlayerState, setPrivatePlayerState] = useState(getDefaultPrivatePlayerState());\r\n  const [isTextLoading, setIsTextLoading] = useState(false);\r\n  const [activeUsers, setActiveUsers] = useState([]);\r\n  const [chatMessages, setChatMessages] = useState([]);\r\n  const [currentChatMessage, setCurrentChatMessage] = useState('');\r\n  const [actingPlayer, setActingPlayer] = useState(null);\r\n  const [isActionInProgress, setIsActionInProgress] = useState(false);\r\n  const [db, setDb] = useState(null);\r\n  const [auth, setAuth] = useState(null);\r\n  const [userId, setUserId] = useState(null);\r\n  const [isAuthReady, setIsAuthReady] = useState(false);\r\n  const logEndRef = useRef(null);\r\n  const chatEndRef = useRef(null);\r\n  const [nickname, setNickname] = useState(() => localStorage.getItem('nickname') || '');\r\n  const [showNicknameModal, setShowNicknameModal] = useState(!localStorage.getItem('nickname'));\r\n  const [nicknameInput, setNicknameInput] = useState('');\r\n  const [accordion, setAccordion] = useState({ gameLog: true, chat: true, users: true, playerInfo: true });\r\n  const [showResetModal, setShowResetModal] = useState(false);\r\n  const [isResetting, setIsResetting] = useState(false);\r\n  const [llmError, setLlmError] = useState(null);\r\n  const [llmRetryPrompt, setLlmRetryPrompt] = useState(null);\r\n\r\n  const handleNicknameSubmit = () => {\r\n    if (nicknameInput.trim()) {\r\n      const finalNickname = nicknameInput.trim();\r\n      setNickname(finalNickname);\r\n      localStorage.setItem('nickname', finalNickname);\r\n      setShowNicknameModal(false);\r\n      if (userId && db) {\r\n          const userDocRef = doc(db, 'artifacts', appId, 'public', 'data', 'activeUsers', userId);\r\n          setDoc(userDocRef, { nickname: finalNickname }, { merge: true });\r\n      }\r\n    }\r\n  };\r\n\r\n  const getDisplayName = (uid) => {\r\n    if (uid === userId) return nickname || `플레이어 ${userId?.substring(0, 4)}`;\r\n    const user = activeUsers.find(u => u.id === uid);\r\n    return user?.nickname || `플레이어 ${uid?.substring(0, 4)}`;\r\n  };\r\n\r\n  const resetAllGameData = async () => {\r\n    if (!db || !isAuthReady) return;\r\n    setIsResetting(true);\r\n    try {\r\n        const collectionsToDelete = [\r\n            collection(db, 'artifacts', appId, 'public', 'data', 'chatMessages'),\r\n            collection(db, 'artifacts', appId, 'public', 'data', 'activeUsers'),\r\n        ];\r\n\r\n        for (const colRef of collectionsToDelete) {\r\n            const snapshot = await getDocs(colRef);\r\n            for (const docSnap of snapshot.docs) {\r\n                await deleteDoc(docSnap.ref);\r\n            }\r\n        }\r\n\r\n        const usersColRef = collection(db, 'artifacts', appId, 'users');\r\n        const usersSnapshot = await getDocs(usersColRef);\r\n        for (const userDoc of usersSnapshot.docs) {\r\n            const playerStateColRef = collection(db, 'artifacts', appId, 'users', userDoc.id, 'playerState');\r\n            const playerStateSnapshot = await getDocs(playerStateColRef);\r\n            for (const stateDoc of playerStateSnapshot.docs) {\r\n                await deleteDoc(stateDoc.ref);\r\n            }\r\n        }\r\n\r\n        const mainScenarioRef = getMainScenarioRef(db, appId);\r\n        await setDoc(mainScenarioRef, { ...getDefaultGameState(), storyLog: getDefaultGameState().log, lastUpdate: serverTimestamp() });\r\n        \r\n        const gameStatusRef = doc(db, 'artifacts', appId, 'public', 'data', 'gameStatus', 'status');\r\n        await deleteDoc(gameStatusRef);\r\n\r\n        setGameState(getDefaultGameState());\r\n        setPrivatePlayerState(getDefaultPrivatePlayerState());\r\n        setChatMessages([]);\r\n\r\n    } catch (e) {\r\n      setGameState(prev => ({ ...prev, log: [...prev.log, '데이터 초기화 중 오류 발생: ' + e.message] }));\r\n    } finally {\r\n      setIsResetting(false);\r\n      setShowResetModal(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    try {\r\n      const app = initializeApp(firebaseConfig);\r\n      const firestoreDb = getFirestore(app);\r\n      const firebaseAuth = getAuth(app);\r\n      setDb(firestoreDb);\r\n      setAuth(firebaseAuth);\r\n      const unsubscribeAuth = onAuthStateChanged(firebaseAuth, async (user) => {\r\n        if (user) {\r\n          setUserId(user.uid);\r\n          setIsAuthReady(true);\r\n        } else {\r\n            await (initialAuthToken ? signInWithCustomToken(firebaseAuth, initialAuthToken) : signInAnonymously(firebaseAuth));\r\n        }\r\n      });\r\n      return () => unsubscribeAuth();\r\n    } catch (error) {\r\n      console.error(\"Firebase initialization error:\", error);\r\n    }\r\n  }, []);\r\n  \r\n  useEffect(() => {\r\n    if (!db || !userId || !isAuthReady) return;\r\n\r\n    const privateStateRef = getPrivatePlayerStateRef(db, appId, userId);\r\n    const unsubscribe = onSnapshot(privateStateRef, (docSnap) => {\r\n        if (docSnap.exists()) {\r\n            setPrivatePlayerState(docSnap.data());\r\n        } else {\r\n            setDoc(privateStateRef, getDefaultPrivatePlayerState());\r\n        }\r\n    }, (error) => {\r\n        console.error(\"Private player state snapshot error:\", error);\r\n    });\r\n\r\n    return () => unsubscribe();\r\n  }, [db, userId, isAuthReady]);\r\n\r\n  useEffect(() => {\r\n    if (!db || !isAuthReady || !userId || !auth) return;\r\n\r\n    const gameStatusDocRef = doc(db, 'artifacts', appId, 'public', 'data', 'gameStatus', 'status');\r\n    const unsubscribeGameStatus = onSnapshot(gameStatusDocRef, (docSnap) => {\r\n      const data = docSnap.data();\r\n      setIsActionInProgress(data?.isActionInProgress || false);\r\n      setActingPlayer(data?.actingPlayer || null);\r\n    });\r\n\r\n    const chatMessagesColRef = collection(db, 'artifacts', appId, 'public', 'data', 'chatMessages');\r\n    const unsubscribeChat = onSnapshot(query(chatMessagesColRef), (snapshot) => {\r\n        const messages = snapshot.docs\r\n            .map(doc => ({ id: doc.id, ...doc.data() }))\r\n            .sort((a, b) => (a.timestamp?.toMillis() || 0) - (b.timestamp?.toMillis() || 0));\r\n        setChatMessages(messages);\r\n    });\r\n\r\n    const activeUsersColRef = collection(db, 'artifacts', appId, 'public', 'data', 'activeUsers');\r\n    const unsubscribeActiveUsers = onSnapshot(query(activeUsersColRef), (snapshot) => {\r\n      const cutoffTime = Date.now() - 60 * 1000;\r\n      const users = snapshot.docs\r\n        .map(doc => ({ id: doc.id, ...doc.data() }))\r\n        .filter(user => user.lastActive && user.lastActive.toMillis() > cutoffTime);\r\n      setActiveUsers(users);\r\n    });\r\n    \r\n    const updateUserPresence = async () => {\r\n      if (userId) {\r\n        const userDocRef = doc(db, 'artifacts', appId, 'public', 'data', 'activeUsers', userId);\r\n        await setDoc(userDocRef, {\r\n          lastActive: serverTimestamp(),\r\n          nickname: nickname || `플레이어 ${userId.substring(0, 4)}`,\r\n          profession: gameState.player.profession,\r\n        }, { merge: true });\r\n      }\r\n    };\r\n    updateUserPresence();\r\n    const presenceInterval = setInterval(updateUserPresence, 30000);\r\n\r\n    return () => {\r\n      unsubscribeGameStatus();\r\n      unsubscribeChat();\r\n      unsubscribeActiveUsers();\r\n      clearInterval(presenceInterval);\r\n    };\r\n  }, [db, isAuthReady, userId, auth, nickname, gameState.player.profession]);\r\n\r\n  useEffect(() => {\r\n    if (accordion.gameLog && logEndRef.current) logEndRef.current.scrollIntoView({ behavior: \"smooth\" });\r\n  }, [gameState.log, accordion.gameLog]);\r\n\r\n  useEffect(() => {\r\n    if (accordion.chat && chatEndRef.current) chatEndRef.current.scrollIntoView({ behavior: \"smooth\" });\r\n  }, [chatMessages, accordion.chat]);\r\n  \r\n  // ====================================================================\r\n  // LLM PROMPT ENGINEERING SECTION\r\n  // ====================================================================\r\n\r\n  const systemPrompt = `\r\n    ### 페르소나 (Persona)\r\n    당신은 TRPG(Tabletop Role-Playing Game)의 최고 실력자 '게임 마스터(GM)'입니다. 당신의 임무는 단순한 스토리 생성이 아니라, 각 플레이어가 자신의 서사의 주인공이 되면서도, 모두가 하나의 거대한 세계관 속에서 살아 숨 쉬고 있다는 느낌을 받도록 만드는 것입니다. 당신은 유려한 문장가이자, 치밀한 설계자이며, 플레이어들의 행동에 즉각적으로 반응하는 유연한 스토리텔러입니다.\r\n\r\n    ### 핵심 철학: 하이브리드 월드 (Hybrid World)\r\n    이 세계는 '공유된 현실'과 '개인적인 서사'가 공존합니다.\r\n    1.  **공유된 현실 (Shared Reality):** 세상의 중요한 사건, 장소의 변화, 주요 NPC의 죽음 등은 모든 플레이어가 함께 경험하는 절대적인 현실입니다. 이는 'story'와 'sharedStateUpdates'로 표현됩니다.\r\n    2.  **개인적인 서사 (Personal Narrative):** 플레이어의 내면의 생각, 남들은 모르는 비밀 지식, 개인적인 퀘스트의 진행 등은 오직 그 플레이어에게만 주어지는 고유한 경험입니다. 이는 'privateStory', 'privateChoices', 'privateStateUpdates'로 표현됩니다.\r\n\r\n    ### 스토리텔링 원칙\r\n    * **보여주되, 말하지 말라 (Show, Don't Tell):** '그는 화가 났다'가 아니라 '그는 주먹을 불끈 쥐었다'라고 묘사하십시오.\r\n    * **역할 존중:** 플레이어의 직업, 능력치, 아이템, 그리고 특히 **'[개인 정보]'**에 담긴 단서('knownClues')나 퀘스트('activeQuests')는 당신이 스토리를 만들 때 가장 먼저 고려해야 할 재료입니다. 이것이 개인화된 경험의 핵심입니다.\r\n    * **살아있는 세계:** '[주변 플레이어]' 정보를 활용하여 다른 플레이어들의 존재를 이야기에 자연스럽게 녹여내십시오. 그들의 등장은 단순한 배경이 아니라, 새로운 사건의 계기가 되어야 합니다.\r\n    * **선택의 무게:** 플레이어의 선택은 반드시 의미 있는 결과를 가져와야 합니다. 사소한 선택이 나비효과를 일으킬 수도 있습니다.\r\n\r\n    ### JSON 출력 규칙 (매우 중요)\r\n    당신은 반드시 아래의 JSON 구조를 완벽하게 따라야 합니다. 설명(comment)은 절대 포함하지 마십시오.\r\n    {\r\n      \"story\": \"모든 플레이어가 볼 수 있는 공유된 사건에 대한 3인칭 서사. 이 사건의 결과로 세상이 어떻게 변했는지 객관적으로 묘사합니다.\",\r\n      \"privateStory\": \"선택을 한 플레이어만 볼 수 있는 2인칭 서사. '당신은...', '...라고 느낀다.' 와 같이 내면의 생각, 감각, 남들이 눈치채지 못한 미세한 발견 등을 묘사합니다.\",\r\n      \"choices\": [\r\n        \"다른 플레이어들도 선택할 수 있는 일반적인 행동들.\"\r\n      ],\r\n      \"privateChoices\": [\r\n        \"오직 이 플레이어의 직업, 아이템, 퀘스트, 단서 때문에 가능한 특별한 행동들.\"\r\n      ],\r\n      \"sharedStateUpdates\": {\r\n        \"location\": \"플레이어 그룹의 현재 위치. 변경되었을 경우에만 포함됩니다.\"\r\n      },\r\n      \"privateStateUpdates\": {\r\n        \"inventory\": [\"업데이트된 전체 인벤토리 목록\"],\r\n        \"stats\": {\"strength\": 12, \"intelligence\": 10, ...},\r\n        \"activeQuests\": [\"업데이트된 개인 퀘스트 목록\"],\r\n        \"knownClues\": [\"새롭게 알게 된 단서를 포함한 전체 단서 목록\"],\r\n        \"companions\": [\"업데이트된 동료 목록\"],\r\n        \"reputation\": {\"세력명\": \"상태\", ...}\r\n      }\r\n    }\r\n\r\n    ### 규칙 상세\r\n    * 'privateChoices' 예시: 플레이어의 'knownClues'에 '가문의 문장'이 있다면, \"가문의 문장을 제단에 맞춰본다.\" 와 같은 선택지를 제공하십시오.\r\n    * **상태 업데이트:** 'privateStateUpdates'의 모든 필드는 **변경 여부와 관계없이 항상 현재 플레이어의 전체 상태를 포함**하여 보내야 합니다. 예를 들어, 아이템을 하나 얻었다면, 기존 아이템을 포함한 전체 인벤토리 목록을 'inventory'에 담아야 합니다.\r\n    * 'story'와 'privateStory'는 합쳐서 500자 이내로 간결하게 작성하십시오.\r\n  `;\r\n\r\n  const callGeminiTextLLM = async (promptData) => {\r\n    setIsTextLoading(true);\r\n    setLlmRetryPrompt(promptData);\r\n    const mainApiKey = \"AIzaSyDC11rqjU30OJnLjaBFOaazZV0klM5raU8\"; // This will be provided by the Canvas environment.\r\n    const backupApiKey = \"AIzaSyAhscNjW8GmwKPuKzQ47blCY_bDanR\"; // This will be provided by the Canvas environment.\r\n    const getApiUrl = (apiKey) => `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;\r\n    \r\n    // LLM이 상황을 명확하게 파악하도록 구조화된 User Prompt\r\n    const userPrompt = `\r\n      [상황 분석 요청]\r\n      아래 정보를 바탕으로 플레이어의 행동에 대한 결과를 생성해주십시오.\r\n\r\n      [공유 컨텍스트]\r\n      - 현재 위치: ${promptData.sharedInfo.currentLocation}\r\n      - 이전 주요 사건 로그 (최대 5개): ${JSON.stringify(promptData.history.slice(-5))}\r\n\r\n      [개인 정보 (현재 플레이어)]\r\n      - 직업: ${promptData.privateInfo.profession || gameState.player.profession}\r\n      - 능력치: ${JSON.stringify(promptData.privateInfo.stats)}\r\n      - 인벤토리: ${JSON.stringify(promptData.privateInfo.inventory)}\r\n      - 활성 퀘스트: ${JSON.stringify(promptData.privateInfo.activeQuests)}\r\n      - 알려진 단서: ${JSON.stringify(promptData.privateInfo.knownClues)}\r\n      - 평판: ${JSON.stringify(promptData.privateInfo.reputation)}\r\n\r\n      [플레이어의 행동]\r\n      - 선택: \"${promptData.playerChoice}\"\r\n\r\n      [주변 플레이어]\r\n      - ${promptData.activeUsers.length > 0 ? JSON.stringify(promptData.activeUsers) : \"현재 주변에 다른 플레이어가 없습니다.\"}\r\n    `;\r\n\r\n    const payload = { contents: [{ role: \"user\", parts: [{ text: systemPrompt }] }, { role: \"model\", parts: [{ text: \"{}\" }] }, { role: \"user\", parts: [{ text: userPrompt }] }] };\r\n\r\n    const tryGeminiCall = async (apiKey) => fetch(getApiUrl(apiKey), { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });\r\n\r\n    try {\r\n      let response = await tryGeminiCall(mainApiKey);\r\n      if (!response.ok) {\r\n        response = await tryGeminiCall(backupApiKey);\r\n      }\r\n      if (!response.ok) {\r\n        throw new Error(`HTTP error! status: ${response.status}`);\r\n      }\r\n      const result = await response.json();\r\n      const llmOutputText = result.candidates?.[0]?.content?.parts?.[0]?.text;\r\n      const jsonMatch = llmOutputText?.match(/\\{[\\s\\S]*\\}/);\r\n      if (jsonMatch) return JSON.parse(jsonMatch[0]);\r\n      throw new Error(\"Valid JSON object not found in LLM response.\");\r\n    } catch (error) {\r\n      console.error(\"LLM API call error:\", error);\r\n      setLlmError(error.message || 'LLM 호출 실패');\r\n      return null;\r\n    } finally {\r\n      setIsTextLoading(false);\r\n    }\r\n  };\r\n\r\n  // ====================================================================\r\n  // END OF LLM PROMPT ENGINEERING SECTION\r\n  // ====================================================================\r\n\r\n\r\n  const sendChatMessage = async () => {\r\n    if (!db || !userId || !isAuthReady || !currentChatMessage.trim()) return;\r\n    try {\r\n      const chatCollectionRef = collection(db, 'artifacts', appId, 'public', 'data', 'chatMessages');\r\n      await addDoc(chatCollectionRef, { userId, displayName: getDisplayName(userId), message: currentChatMessage, timestamp: serverTimestamp() });\r\n      setCurrentChatMessage('');\r\n    } catch (error) {\r\n      console.error(\"Error sending chat message:\", error);\r\n    }\r\n  };\r\n\r\n  // *** 권한 오류 수정을 위해 isAuthReady를 의존성에 추가하고 로직을 수정 ***\r\n  useEffect(() => {\r\n    if (!db || !appId || !isAuthReady) return; // 인증이 준비될 때까지 대기\r\n    const ref = getMainScenarioRef(db, appId);\r\n    const unsubscribe = onSnapshot(ref, async (snap) => {\r\n      if (snap.exists()) {\r\n        const data = snap.data();\r\n        setGameState(prev => ({\r\n          ...prev,\r\n          log: data.storyLog || prev.log,\r\n          choices: data.choices || [],\r\n          phase: data.phase || prev.phase,\r\n          player: { ...prev.player, currentLocation: data.player?.currentLocation || prev.player.currentLocation }\r\n        }));\r\n      } else {\r\n        // 최초 시나리오 생성\r\n        const def = getDefaultGameState();\r\n        try {\r\n            await setDoc(ref, { ...def, storyLog: def.log, lastUpdate: serverTimestamp() }, { merge: true });\r\n            setGameState(def);\r\n        } catch (e) {\r\n            console.error(\"Failed to create initial scenario:\", e);\r\n        }\r\n      }\r\n    }, (error) => {\r\n      console.error(\"Main scenario snapshot error:\", error);\r\n      setLlmError(\"시나리오를 불러오는 중 오류가 발생했습니다. 페이지를 새로고침 해보세요.\");\r\n    });\r\n    return () => unsubscribe();\r\n  }, [db, appId, isAuthReady]); // isAuthReady를 의존성 배열에 추가\r\n\r\n  const updateGameStateFromLLM = async (llmResponse) => {\r\n    if (!db || !appId || !userId) return;\r\n    \r\n    const mainScenarioRef = getMainScenarioRef(db, appId);\r\n    const newChoices = [...(llmResponse.choices || []), ...(llmResponse.privateChoices || [])];\r\n\r\n    try {\r\n        await runTransaction(db, async (transaction) => {\r\n            const scenarioDoc = await transaction.get(mainScenarioRef);\r\n            if (!scenarioDoc.exists()) throw \"시나리오 문서가 존재하지 않습니다.\";\r\n            \r\n            const currentData = scenarioDoc.data();\r\n            // 트랜잭션에서는 공유 로그만 업데이트\r\n            const publicLog = [...(currentData.storyLog || []), llmResponse.story];\r\n            \r\n            transaction.update(mainScenarioRef, {\r\n                storyLog: publicLog,\r\n                choices: newChoices,\r\n                phase: 'playing',\r\n                'player.currentLocation': llmResponse.sharedStateUpdates?.location || currentData.player.currentLocation,\r\n                lastUpdate: serverTimestamp(),\r\n                lastActor: { id: userId, displayName: getDisplayName(userId) }\r\n            });\r\n        });\r\n\r\n        // 트랜잭션 성공 후, 로컬 상태에만 개인 스토리 추가\r\n        // onSnapshot이 비동기적으로 작동하므로, 즉각적인 UI 반영을 위해 로컬 상태를 직접 조작\r\n        const docSnap = await getDoc(mainScenarioRef);\r\n        const updatedPublicLog = docSnap.data().storyLog;\r\n        const finalLog = llmResponse.privateStory \r\n            ? [...updatedPublicLog, `\\n[당신만 아는 사실] ${llmResponse.privateStory}`]\r\n            : [...updatedPublicLog];\r\n        \r\n        setGameState(prev => ({...prev, log: finalLog, choices: newChoices}));\r\n\r\n    } catch (error) {\r\n        console.error(\"공유 상태 업데이트 실패:\", error);\r\n        setLlmError(\"시나리오를 업데이트하는 데 실패했습니다.\");\r\n    }\r\n\r\n    const privateStateRef = getPrivatePlayerStateRef(db, appId, userId);\r\n    if (llmResponse.privateStateUpdates) {\r\n        await setDoc(privateStateRef, llmResponse.privateStateUpdates, { merge: false });\r\n    }\r\n  };\r\n\r\n  const handleChoiceClick = async (choice) => {\r\n    if (isTextLoading || isActionInProgress) return;\r\n\r\n    const gameStatusRef = doc(db, 'artifacts', appId, 'public', 'data', 'gameStatus', 'status');\r\n\r\n    try {\r\n      await runTransaction(db, async (transaction) => {\r\n        const statusDoc = await transaction.get(gameStatusRef);\r\n        if (statusDoc.exists() && statusDoc.data().isActionInProgress) {\r\n          throw new Error(\"다른 플레이어가 행동 중입니다. 잠시 후 다시 시도해주세요.\");\r\n        }\r\n        transaction.set(gameStatusRef, {\r\n          isActionInProgress: true,\r\n          actingPlayer: { id: userId, displayName: getDisplayName(userId) }\r\n        }, { merge: true });\r\n      });\r\n\r\n      const newLog = [...gameState.log, `\\n> ${choice}`];\r\n      setGameState(prev => ({ ...prev, log: newLog }));\r\n      \r\n      if (gameState.phase === 'characterSelection') {\r\n        const choiceKey = choice.split('.')[0];\r\n        const selectedProfession = professions[choiceKey];\r\n        if (selectedProfession) {\r\n          const initialMotivation = selectedProfession.motivation;\r\n          const finalLog = [...newLog, `\\n당신은 '${selectedProfession.name}'입니다. ${initialMotivation}`];\r\n          const choices = [\"여관을 둘러본다.\", \"다른 모험가에게 말을 건다.\", \"여관 주인에게 정보를 묻는다.\"];\r\n          \r\n          const mainScenarioRef = getMainScenarioRef(db, appId);\r\n          await setDoc(mainScenarioRef, {\r\n              phase: 'playing',\r\n              storyLog: finalLog,\r\n              choices: choices,\r\n              lastUpdate: serverTimestamp(),\r\n              lastActor: { id: userId, displayName: getDisplayName(userId) }\r\n          }, { merge: true });\r\n\r\n          const privateStateRef = getPrivatePlayerStateRef(db, appId, userId);\r\n          const newPrivateState = getDefaultPrivatePlayerState();\r\n          newPrivateState.initialMotivation = initialMotivation;\r\n          await setDoc(privateStateRef, newPrivateState, { merge: true });\r\n          \r\n          setGameState(prev => ({ ...prev, player: {...prev.player, profession: selectedProfession.name }}));\r\n          return;\r\n        }\r\n      }\r\n\r\n      const promptData = {\r\n        playerChoice: choice,\r\n        sharedInfo: {\r\n            currentLocation: gameState.player.currentLocation,\r\n        },\r\n        privateInfo: {\r\n            ...privatePlayerState,\r\n            profession: gameState.player.profession // privateInfo에 직업 정보 추가\r\n        },\r\n        history: newLog,\r\n        activeUsers: activeUsers.map(u => ({ nickname: getDisplayName(u.id), profession: u.profession })).filter(u => u.id !== userId),\r\n      };\r\n      \r\n      const llmResponse = await callGeminiTextLLM(promptData);\r\n      if (llmResponse) {\r\n        await updateGameStateFromLLM(llmResponse);\r\n        setLlmError(null);\r\n      } else {\r\n        throw new Error(\"LLM으로부터 유효한 응답을 받지 못했습니다.\");\r\n      }\r\n    } catch (error) {\r\n      console.error(\"행동 처리 중 오류:\", error.message);\r\n      setLlmError(error.message);\r\n    } finally {\r\n      await setDoc(gameStatusRef, { isActionInProgress: false, actingPlayer: null }, { merge: true });\r\n      setIsTextLoading(false);\r\n    }\r\n  };\r\n\r\n  const toggleAccordion = (key) => {\r\n    setAccordion(prev => ({ ...prev, [key]: !prev[key] }));\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-900 text-gray-100 flex flex-col items-center justify-center p-4 font-sans\">\r\n      {showNicknameModal && (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50\">\r\n          <div className=\"bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-md space-y-4\">\r\n            <h3 className=\"text-xl font-bold text-gray-100\">닉네임을 입력하세요</h3>\r\n            <input\r\n              className=\"w-full p-3 rounded-md bg-gray-700 border border-gray-600 text-gray-100 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 text-lg\"\r\n              placeholder=\"닉네임\"\r\n              value={nicknameInput}\r\n              onChange={e => setNicknameInput(e.target.value)}\r\n              onKeyDown={e => { if (e.key === 'Enter') handleNicknameSubmit(); }}\r\n              autoFocus\r\n            />\r\n            <button\r\n              className=\"w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-md transition duration-300 disabled:opacity-50\"\r\n              onClick={handleNicknameSubmit}\r\n              disabled={!nicknameInput.trim()}\r\n            >\r\n              시작하기\r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {showResetModal && (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50\">\r\n          <div className=\"bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-md space-y-4\">\r\n            <h3 className=\"text-xl font-bold text-red-400\">⚠️ 모든 데이터를 초기화할까요?</h3>\r\n            <p className=\"text-gray-200\">이 작업은 되돌릴 수 없습니다. 모든 시나리오, 로그, 유저, 채팅 데이터가 삭제됩니다.</p>\r\n            <div className=\"flex justify-end gap-3\">\r\n              <button className=\"px-4 py-2 bg-gray-600 hover:bg-gray-700 font-bold rounded-md\" onClick={() => setShowResetModal(false)} disabled={isResetting}>취소</button>\r\n              <button className=\"px-4 py-2 bg-red-600 hover:bg-red-700 font-bold rounded-md\" onClick={resetAllGameData} disabled={isResetting}>{isResetting ? '초기화 중...' : '초기화'}</button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      <div className=\"w-full max-w-5xl bg-gray-800 rounded-lg shadow-xl p-6 md:p-8 flex flex-col lg:flex-row space-y-6 lg:space-y-0 lg:space-x-6\">\r\n        <div className=\"flex flex-col w-full lg:w-2/3 space-y-6\">\r\n          <div className=\"mb-2\">\r\n            <div className=\"flex items-center justify-between cursor-pointer select-none\" onClick={() => toggleAccordion('gameLog')}>\r\n              <h2 className=\"text-lg font-bold text-gray-100\">게임 로그</h2>\r\n              <div className=\"text-xl\">{accordion.gameLog ? '▼' : '▲'}</div>\r\n            </div>\r\n            {accordion.gameLog && (\r\n              <>\r\n                <div className=\"flex justify-end mb-2\">\r\n                  <button className=\"px-3 py-1 bg-red-600 hover:bg-red-700 text-white text-xs rounded-md\" onClick={() => setShowResetModal(true)}>전체 데이터 초기화</button>\r\n                </div>\r\n                <div className=\"flex-grow bg-gray-700 p-4 rounded-md overflow-y-auto h-96 custom-scrollbar text-sm md:text-base leading-relaxed\" style={{ maxHeight: '24rem' }}>\r\n                  {gameState.log.map((line, index) => (\r\n                    <p key={index} className=\"whitespace-pre-wrap mb-1\" dangerouslySetInnerHTML={{ __html: line.replace(/\\n/g, '<br />') }}></p>\r\n                  ))}\r\n                  {isTextLoading && (\r\n                    <div className=\"flex justify-center items-center mt-4\">\r\n                      <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-300\"></div>\r\n                      <span className=\"ml-3 text-gray-400\">이야기를 생성 중...</span>\r\n                    </div>\r\n                  )}\r\n                  {isActionInProgress && (!actingPlayer || actingPlayer.id !== userId) && (\r\n                      <div className=\"text-center text-yellow-400 font-semibold p-2 bg-black bg-opacity-20 rounded-md mt-2\">\r\n                          {actingPlayer ? `${getDisplayName(actingPlayer.id)}님이 선택하고 있습니다...` : \"다른 플레이어가 선택하고 있습니다...\"}\r\n                      </div>\r\n                  )}\r\n                  {llmError && <div className=\"text-red-400 p-2 bg-red-900 bg-opacity-50 rounded mt-2\">오류: {llmError}</div>}\r\n                  <div ref={logEndRef} />\r\n                </div>\r\n              </>\r\n            )}\r\n          </div>\r\n\r\n          <div className=\"flex flex-col gap-3\">\r\n            {gameState.choices.map((choice, index) => (\r\n              <button\r\n                key={index}\r\n                className=\"px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-md shadow-lg transition duration-300 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                onClick={() => handleChoiceClick(choice)}\r\n                disabled={isTextLoading || isActionInProgress}\r\n              >\r\n                {choice}\r\n              </button>\r\n            ))}\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"w-full lg:w-1/3 flex flex-col space-y-6 bg-gray-700 p-4 rounded-lg shadow-inner\">\r\n            <div className=\"mb-2\">\r\n                <div className=\"flex items-center justify-between cursor-pointer select-none\" onClick={() => toggleAccordion('playerInfo')}>\r\n                    <h4 className=\"text-md font-semibold text-gray-200\">내 정보</h4>\r\n                    <div className=\"text-xl\">{accordion.playerInfo ? '▼' : '▲'}</div>\r\n                </div>\r\n                {accordion.playerInfo && gameState.phase === 'playing' && (\r\n                  <div className=\"bg-gray-600 p-3 rounded-md text-xs md:text-sm text-gray-300 space-y-1 h-48 overflow-y-auto custom-scrollbar\">\r\n                    <p><span className=\"font-semibold text-blue-300\">직업:</span> {gameState.player.profession}</p>\r\n                    <p><span className=\"font-semibold text-blue-300\">위치:</span> {gameState.player.currentLocation}</p>\r\n                    <p><span className=\"font-semibold text-blue-300\">능력치:</span> 힘({privatePlayerState.stats.strength}) 지능({privatePlayerState.stats.intelligence}) 민첩({privatePlayerState.stats.agility}) 카리스마({privatePlayerState.stats.charisma})</p>\r\n                    <p><span className=\"font-semibold text-blue-300\">인벤토리:</span> {privatePlayerState.inventory.join(', ') || '비어있음'}</p>\r\n                    <p><span className=\"font-semibold text-blue-300\">퀘스트:</span> {privatePlayerState.activeQuests.join(', ') || '없음'}</p>\r\n                    <p><span className=\"font-semibold text-blue-300\">단서:</span> {privatePlayerState.knownClues.join(', ') || '없음'}</p>\r\n                  </div>\r\n                )}\r\n            </div>\r\n            <div className=\"mb-2\">\r\n                <div className=\"flex items-center justify-between cursor-pointer select-none\" onClick={() => toggleAccordion('users')}>\r\n                    <h4 className=\"text-md font-semibold text-gray-200\">현재 플레이어들</h4>\r\n                    <div className=\"text-xl\">{accordion.users ? '▼' : '▲'}</div>\r\n                </div>\r\n                {accordion.users && (\r\n                    <div className=\"bg-gray-600 p-3 rounded-md h-48 overflow-y-auto custom-scrollbar\">\r\n                        {activeUsers.length > 0 ? (\r\n                            <ul className=\"text-sm text-gray-300 space-y-1\">\r\n                                {activeUsers.map(user => (\r\n                                    <li key={user.id} className=\"truncate p-1 rounded-md\">\r\n                                        <span className=\"font-medium text-green-300\">{getDisplayName(user.id)}</span>\r\n                                        <span className=\"text-gray-400 text-xs\"> ({user.profession || '모험가'})</span>\r\n                                    </li>\r\n                                ))}\r\n                            </ul>\r\n                        ) : <p className=\"text-sm text-gray-400\">활동 중인 플레이어가 없습니다.</p>}\r\n                    </div>\r\n                )}\r\n            </div>\r\n            <div className=\"mb-2\">\r\n                <div className=\"flex items-center justify-between cursor-pointer select-none\" onClick={() => toggleAccordion('chat')}>\r\n                    <h4 className=\"text-md font-semibold text-gray-200\">공개 채팅</h4>\r\n                    <div className=\"text-xl\">{accordion.chat ? '▼' : '▲'}</div>\r\n                </div>\r\n                {accordion.chat && (\r\n                    <div className=\"bg-gray-600 p-3 rounded-md flex flex-col h-64\">\r\n                        <div className=\"flex-grow overflow-y-auto custom-scrollbar mb-3 text-sm space-y-2\">\r\n                            {chatMessages.map((msg) => (\r\n                                <div key={msg.id}><p><span className=\"font-medium text-yellow-300\">{getDisplayName(msg.userId)}:</span> {msg.message}</p></div>\r\n                            ))}\r\n                            <div ref={chatEndRef} />\r\n                        </div>\r\n                        <div className=\"flex\">\r\n                            <input type=\"text\" className=\"flex-grow p-2 rounded-l-md bg-gray-700 border border-gray-600\" value={currentChatMessage} onChange={(e) => setCurrentChatMessage(e.target.value)} onKeyPress={(e) => e.key === 'Enter' && sendChatMessage()} disabled={!isAuthReady} />\r\n                            <button className=\"px-4 py-2 bg-blue-600 hover:bg-blue-700 font-bold rounded-r-md\" onClick={sendChatMessage} disabled={!isAuthReady || !currentChatMessage.trim()}>보내기</button>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n      </div>\r\n\r\n      <style>\r\n        {`\r\n        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap');\r\n        body { font-family: 'Noto Sans KR', sans-serif; }\r\n        .custom-scrollbar::-webkit-scrollbar { width: 8px; }\r\n        .custom-scrollbar::-webkit-scrollbar-track { background: #4a5568; border-radius: 10px; }\r\n        .custom-scrollbar::-webkit-scrollbar-thumb { background: #6b7280; border-radius: 10px; }\r\n        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #9ca3af; }\r\n        `}\r\n      </style>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default App;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}