{"ast":null,"code":"import React,{useState,useEffect,useRef}from'react';import{initializeApp}from'firebase/app';import{getAuth,signInAnonymously,signInWithCustomToken,onAuthStateChanged}from'firebase/auth';import{getFirestore,doc,setDoc,getDoc,collection,query,onSnapshot,serverTimestamp,addDoc,getDocs,deleteDoc,runTransaction}from'firebase/firestore';// ====================================================================\n// Firebase configuration information - 수정 금지\nimport{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const defaultFirebaseConfig={apiKey:\"AIzaSyBNJtmpRWzjobrY556bnHkwbZmpFJqgPX8\",authDomain:\"text-adventure-game-cb731.firebaseapp.com\",projectId:\"text-adventure-game-cb731\",storageBucket:\"text-adventure-game-cb731.appspot.com\",messagingSenderId:\"1092941614820\",appId:\"1:1092941614820:web:5545f36014b73c268026f1\",measurementId:\"G-FNGF42T1FP\"};// 수정금지\nconst firebaseConfig=defaultFirebaseConfig;const appId=firebaseConfig.projectId;const initialAuthToken=null;// ====================================================================\nconst professions={'1':{name:'몰락한 귀족/기사',motivation:'가문의 몰락 원인을 조사하고, 잃어버린 가문의 보물을 찾아야 합니다.'},'2':{name:'평범한 마을 사람/농부',motivation:'갑자기 마을에 나타난 괴생명체로부터 마을을 지켜야 합니다.'},'3':{name:'젊은 마법사/견습생',motivation:'스승님의 실종에 대한 단서를 찾아야 합니다.'},'4':{name:'용병/모험가',motivation:'의뢰받은 임무를 수행하던 중 예상치 못한 사건에 휘말렸습니다.'},'5':{name:'도적/암살자',motivation:'길드에서 내려온 첫 번째 임무를 완수하고, 그 과정에서 수상한 음모를 감지해야 합니다.'},'6':{name:'왕족/공주/왕자',motivation:'왕실 내의 불화와 암투 속에서 자신의 입지를 다져야 합니다.'}};// Firestore 경로 유틸\nconst getMainScenarioRef=(db,appId)=>doc(db,'artifacts',appId,'public','data','mainScenario','main');const getPrivatePlayerStateRef=(db,appId,userId)=>doc(db,'artifacts',appId,'users',userId,'playerState','state');// [신규] 게임 상태(잠금 등) 경로 유틸\nconst getGameStatusRef=(db,appId)=>doc(db,'artifacts',appId,'public','data','gameStatus','status');// [신규] 세상의 주요 역사 경로 유틸\nconst getMajorEventsRef=(db,appId)=>collection(db,'artifacts',appId,'public','data','majorEvents');// [개선] 상태 초기화 유틸: 신규 기능 반영\nconst getDefaultGameState=()=>({phase:'playing',log:[],choices:[],player:{currentLocation:'방랑자의 안식처'},subtleClues:[]// [신규] 세상에 남겨진 미세한 흔적들\n});const getDefaultPrivatePlayerState=()=>({stats:{strength:10,intelligence:10,agility:10,charisma:10},inventory:[],initialMotivation:'',reputation:{},// 세력 평판은 유지\nactiveQuests:[],companions:[],knownClues:[],characterCreated:false,profession:'',choices:[],groups:[],// [신규] 소속 그룹\nnpcRelations:{}// [신규] 개별 NPC 관계도\n});function App(){const[gameState,setGameState]=useState(getDefaultGameState());const[privatePlayerState,setPrivatePlayerState]=useState(getDefaultPrivatePlayerState());const[isTextLoading,setIsTextLoading]=useState(false);const[activeUsers,setActiveUsers]=useState([]);const[chatMessages,setChatMessages]=useState([]);const[currentChatMessage,setCurrentChatMessage]=useState('');// [개선] 전역 잠금(isActionInProgress, actingPlayer) 대신 지역 잠금(actionLocks) 상태 사용\nconst[actionLocks,setActionLocks]=useState({});const[db,setDb]=useState(null);const[auth,setAuth]=useState(null);const[userId,setUserId]=useState(null);const[isAuthReady,setIsAuthReady]=useState(false);const logEndRef=useRef(null);const chatEndRef=useRef(null);const[nickname,setNickname]=useState(()=>localStorage.getItem('nickname')||'');const[showNicknameModal,setShowNicknameModal]=useState(!localStorage.getItem('nickname'));const[nicknameInput,setNicknameInput]=useState('');const[accordion,setAccordion]=useState({gameLog:true,chat:true,users:true,playerInfo:true});const[showResetModal,setShowResetModal]=useState(false);const[isResetting,setIsResetting]=useState(false);const[llmError,setLlmError]=useState(null);const[llmRetryPrompt,setLlmRetryPrompt]=useState(null);const[isLoading,setIsLoading]=useState(true);// [신규] 세상의 역사를 저장할 상태\nconst[worldHistory,setWorldHistory]=useState([]);const handleNicknameSubmit=()=>{if(nicknameInput.trim()){const finalNickname=nicknameInput.trim();setNickname(finalNickname);localStorage.setItem('nickname',finalNickname);setShowNicknameModal(false);if(userId&&db){const userDocRef=doc(db,'artifacts',appId,'public','data','activeUsers',userId);setDoc(userDocRef,{nickname:finalNickname},{merge:true});}}};const getDisplayName=uid=>{if(uid===userId)return nickname||`플레이어 ${userId===null||userId===void 0?void 0:userId.substring(0,4)}`;const user=activeUsers.find(u=>u.id===uid);return(user===null||user===void 0?void 0:user.nickname)||`플레이어 ${uid===null||uid===void 0?void 0:uid.substring(0,4)}`;};const resetAllGameData=async()=>{if(!db||!isAuthReady)return;setIsResetting(true);try{// ... (기존 리셋 로직과 동일)\n// [신규] 추가된 컬렉션도 삭제 대상에 포함 가능\nconst majorEventsRef=getMajorEventsRef(db,appId);const majorEventsSnapshot=await getDocs(majorEventsRef);for(const docSnap of majorEventsSnapshot.docs){await deleteDoc(docSnap.ref);}}catch(e){console.error(\"Data reset error:\",e);}finally{setIsResetting(false);setShowResetModal(false);window.location.reload();}};useEffect(()=>{try{const app=initializeApp(firebaseConfig);const firestoreDb=getFirestore(app);const firebaseAuth=getAuth(app);setDb(firestoreDb);setAuth(firebaseAuth);const unsubscribeAuth=onAuthStateChanged(firebaseAuth,async user=>{if(user){setUserId(user.uid);setIsAuthReady(true);}else{await(initialAuthToken?signInWithCustomToken(firebaseAuth,initialAuthToken):signInAnonymously(firebaseAuth));}});return()=>unsubscribeAuth();}catch(error){console.error(\"Firebase initialization error:\",error);setLlmError(\"Firebase 초기화에 실패했습니다.\");}},[]);useEffect(()=>{if(!db||!userId||!isAuthReady)return;const setupPlayerState=async()=>{setIsLoading(true);const privateStateRef=getPrivatePlayerStateRef(db,appId,userId);try{const docSnap=await getDoc(privateStateRef);if(!docSnap.exists()){// [개선] 신규 기능이 반영된 기본 상태로 초기화\nawait setDoc(privateStateRef,getDefaultPrivatePlayerState());}const unsubscribe=onSnapshot(privateStateRef,snapshot=>{if(snapshot.exists()){// [개선] 신규 기능이 반영된 기본 상태와 병합\nsetPrivatePlayerState({...getDefaultPrivatePlayerState(),...snapshot.data()});setIsLoading(false);}},err=>{console.error(\"실시간 데이터 수신 오류:\",err);setLlmError(\"데이터 수신 중 오류가 발생했습니다.\");setIsLoading(false);});return unsubscribe;}catch(error){console.error(\"플레이어 상태 설정 오류:\",error);setLlmError(\"플레이어 정보를 가져오는 데 실패했습니다.\");setIsLoading(false);}};let unsubscribePromise=setupPlayerState();return()=>{unsubscribePromise.then(unsub=>{if(unsub)unsub();});};},[db,userId,isAuthReady]);useEffect(()=>{if(isLoading||!db||!isAuthReady||!userId||!auth)return;if(!privatePlayerState.characterCreated)return;// [개선] 게임 상태 리스너: 지역 잠금(actionLocks) 상태를 실시간으로 동기화\nconst gameStatusRef=getGameStatusRef(db,appId);const unsubscribeGameStatus=onSnapshot(gameStatusRef,docSnap=>{var _docSnap$data;setActionLocks(((_docSnap$data=docSnap.data())===null||_docSnap$data===void 0?void 0:_docSnap$data.actionLocks)||{});});const chatMessagesColRef=collection(db,'artifacts',appId,'public','data','chatMessages');const unsubscribeChat=onSnapshot(query(chatMessagesColRef),snapshot=>{const messages=snapshot.docs.map(d=>({id:d.id,...d.data()})).sort((a,b)=>{var _a$timestamp,_b$timestamp;return(((_a$timestamp=a.timestamp)===null||_a$timestamp===void 0?void 0:_a$timestamp.toMillis())||0)-(((_b$timestamp=b.timestamp)===null||_b$timestamp===void 0?void 0:_b$timestamp.toMillis())||0);});setChatMessages(messages);});const activeUsersColRef=collection(db,'artifacts',appId,'public','data','activeUsers');const unsubscribeActiveUsers=onSnapshot(query(activeUsersColRef),snapshot=>{const cutoffTime=Date.now()-60*1000;const users=snapshot.docs.map(d=>({id:d.id,...d.data()})).filter(u=>u.lastActive&&u.lastActive.toMillis()>cutoffTime);setActiveUsers(users);});// [개선] 메인 시나리오 리스너: subtleClues(미세한 흔적)도 함께 동기화\nconst mainScenarioRef=getMainScenarioRef(db,appId);const unsubscribeMainScenario=onSnapshot(mainScenarioRef,snap=>{if(snap.exists()){const data=snap.data();setGameState(prev=>{var _data$player;return{...prev,log:data.storyLog||[],choices:data.choices||[],player:{...prev.player,currentLocation:((_data$player=data.player)===null||_data$player===void 0?void 0:_data$player.currentLocation)||prev.player.currentLocation},subtleClues:data.subtleClues||[]};});}},error=>{console.error(\"Main scenario snapshot error:\",error);setLlmError(\"시나리오를 불러오는 중 오류가 발생했습니다.\");});// [신규] 세상의 주요 역사 데이터 불러오기 (실제 앱에서는 필요에 따라 로드)\nconst fetchHistory=async()=>{const historySnapshot=await getDocs(getMajorEventsRef(db,appId));const historyData=historySnapshot.docs.map(doc=>doc.data().summary);setWorldHistory(historyData);};fetchHistory();return()=>{unsubscribeGameStatus();unsubscribeChat();unsubscribeActiveUsers();unsubscribeMainScenario();};},[db,isAuthReady,userId,auth,isLoading,privatePlayerState.characterCreated]);useEffect(()=>{if(!db||!userId||!nickname)return;const updateUserPresence=async()=>{const userDocRef=doc(db,'artifacts',appId,'public','data','activeUsers',userId);await setDoc(userDocRef,{lastActive:serverTimestamp(),nickname:nickname||`플레이어 ${userId.substring(0,4)}`,profession:privatePlayerState.profession},{merge:true});};const handleVisibilityChange=()=>{if(document.visibilityState==='visible'){updateUserPresence();}};document.addEventListener('visibilitychange',handleVisibilityChange);updateUserPresence();return()=>{document.removeEventListener('visibilitychange',handleVisibilityChange);};},[db,userId,nickname,privatePlayerState.profession]);useEffect(()=>{if(accordion.gameLog&&logEndRef.current)logEndRef.current.scrollIntoView({behavior:\"smooth\"});},[gameState.log,accordion.gameLog]);useEffect(()=>{if(accordion.chat&&chatEndRef.current)chatEndRef.current.scrollIntoView({behavior:\"smooth\"});},[chatMessages,accordion.chat]);// [개선] 시스템 프롬프트: 우리의 모든 아이디어를 반영하여 대폭 수정\nconst systemPrompt=`\n    ### 페르소나 (Persona)\n    당신은 세계 최고의 TRPG '게임 마스터(GM)'입니다. 당신의 임무는 유기적으로 살아 숨 쉬는 세계를 창조하는 것입니다. 플레이어의 선택은 세상에 영구적인 흔적을 남기고, 다른 플레이어의 경험에 영향을 미치며, 세상의 역사를 바꾸어야 합니다.\n\n    ### 핵심 철학: 다층적 서사 (Multi-layered Narrative)\n    1.  **공유된 현실 (Shared Reality):** 세상의 중요한 사건, 장소의 변화 등은 모든 플레이어가 함께 경험하는 절대적인 현실입니다. ('story', 'sharedStateUpdates')\n    2.  **개인적 서사 (Personal Narrative):** 플레이어의 내면, 비밀 지식, 개인 퀘스트 등은 오직 그 플레이어에게만 주어지는 고유한 경험입니다. ('privateStory', 'privateChoices')\n    3.  **[신규] 그룹 서사 (Group Narrative):** 같은 그룹(길드, 파티 등)에 소속된 플레이어들만 공유하는 비밀스러운 이야기입니다. ('groupStory', 'groupChoices')\n\n    ### 스토리텔링 원칙\n    * **살아있는 세계:** 플레이어의 행동은 세상에 '미세한 흔적(subtleClues)'을 남겨 다른 플레이어가 발견할 수 있게 하십시오. 'NPC 관계도(npcRelations)'에 따라 NPC들의 반응이 달라져야 하며, '세상의 주요 역사(worldHistory)'는 현재의 사건에 영향을 미쳐야 합니다.\n    * **역할 존중:** 플레이어의 직업, 능력치, 아이템, 소속 그룹, 그리고 '개인 정보'는 당신이 스토리를 만들 때 가장 먼저 고려해야 할 재료입니다.\n\n    ### JSON 출력 규칙 (매우 중요)\n    당신은 반드시 아래의 JSON 구조를 완벽하게 따라야 합니다. 설명(comment)은 절대 포함하지 마십시오.\n    {\n      \"story\": \"모든 플레이어가 볼 수 있는 공유된 사건에 대한 3인칭 서사.\",\n      \"privateStory\": \"선택을 한 플레이어만 볼 수 있는 2인칭 서사. 내면의 생각, 감각 등을 묘사.\",\n      \"groupStory\": \"같은 그룹 소속원들만 볼 수 있는 비밀스러운 이야기. 해당사항 없으면 null.\",\n      \"choices\": [\"다른 플레이어들도 선택할 수 있는 일반적인 행동들.\"],\n      \"privateChoices\": [\"오직 이 플레이어의 특성 때문에 가능한 특별한 행동들.\"],\n      \"groupChoices\": [\"같은 그룹 소속원들만 할 수 있는 비밀 행동들.\"],\n      \"sharedStateUpdates\": {\n        \"location\": \"플레이어 그룹의 현재 위치. 변경되었을 경우에만 포함.\",\n        \"subtleClues\": [\n            {\"location\": \"장소명\", \"clue\": \"새롭게 생성된 단서\", \"timestamp\": \"ISO8601 형식 시간\"}\n        ]\n      },\n      \"privateStateUpdates\": {\n        \"inventory\": [\"업데이트된 전체 인벤토리 목록\"],\n        \"stats\": {\"strength\": 12, \"intelligence\": 10, \"agility\": 10, \"charisma\": 10 },\n        \"activeQuests\": [\"업데이트된 개인 퀘스트 목록\"],\n        \"knownClues\": [\"새롭게 알게 된 단서를 포함한 전체 단서 목록\"],\n        \"groups\": [\"업데이트된 전체 소속 그룹 목록\"],\n        \"npcRelations\": {\"가라크\": 55, \"엘라라\": -10}\n      }\n    }\n\n    ### 규칙 상세\n    * **상태 업데이트:** privateStateUpdates의 모든 필드는 항상 현재 플레이어의 전체 상태를 포함하여 보내야 합니다.\n    * 'story', 'privateStory', 'groupStory'는 합쳐서 500자 이내로 간결하게 작성하십시오.\n  `;const callGeminiTextLLM=async promptData=>{setIsTextLoading(true);setLlmRetryPrompt(promptData);const mainApiKey=\"AIzaSyDC11rqjU30OJnLjaBFOaazZV0klM5raU8\";// 보안상 실제 앱에서는 서버에서 관리해야 합니다.\nconst backupApiKey=\"AIzaSyAhscNjW8GmwKPuKzQ47blCY_bDanR-B84\";const getApiUrl=apiKey=>`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;const history=promptData.history.map(event=>event.publicStory).slice(-5);// [개선] 프롬프트: 새로운 시스템을 모두 반영\nconst userPrompt=`\n      [상황 분석 요청]\n      아래 정보를 바탕으로 플레이어의 행동에 대한 결과를 생성해주십시오.\n\n      [세상의 주요 역사]\n      - ${promptData.worldHistory.length>0?promptData.worldHistory.join('\\n- '):\"특별한 역사가 기록되지 않았습니다.\"}\n      \n      [공유 컨텍스트]\n      - 현재 위치: ${promptData.sharedInfo.currentLocation}\n      - 이전 주요 사건 로그 (최대 5개): ${JSON.stringify(history)}\n      - 세상에 남겨진 흔적들: ${JSON.stringify(promptData.sharedInfo.subtleClues)}\n\n      [개인 정보 (현재 플레이어)]\n      - 직업: ${promptData.privateInfo.profession}\n      - 능력치: ${JSON.stringify(promptData.privateInfo.stats)}\n      - 인벤토리: ${JSON.stringify(promptData.privateInfo.inventory)}\n      - 활성 퀘스트: ${JSON.stringify(promptData.privateInfo.activeQuests)}\n      - 알려진 단서: ${JSON.stringify(promptData.privateInfo.knownClues)}\n      - 소속 그룹: ${JSON.stringify(promptData.privateInfo.groups)}\n      - NPC 관계도: ${JSON.stringify(promptData.privateInfo.npcRelations)}\n\n      [플레이어의 행동]\n      - 선택: \"${promptData.playerChoice}\"\n\n      [주변 플레이어]\n      - ${promptData.activeUsers.length>0?JSON.stringify(promptData.activeUsers.map(u=>({nickname:u.nickname,profession:u.profession}))):\"현재 주변에 다른 플레이어가 없습니다.\"}\n    `;const payload={contents:[{role:\"user\",parts:[{text:systemPrompt}]},{role:\"model\",parts:[{text:\"{}\"}]},{role:\"user\",parts:[{text:userPrompt}]}]};const tryGeminiCall=async apiKey=>fetch(getApiUrl(apiKey),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});try{var _result$candidates,_result$candidates$,_result$candidates$$c,_result$candidates$$c2,_result$candidates$$c3;let response=await tryGeminiCall(mainApiKey);if(!response.ok){response=await tryGeminiCall(backupApiKey);}if(!response.ok){throw new Error(`HTTP error! status: ${response.status}`);}const result=await response.json();const llmOutputText=(_result$candidates=result.candidates)===null||_result$candidates===void 0?void 0:(_result$candidates$=_result$candidates[0])===null||_result$candidates$===void 0?void 0:(_result$candidates$$c=_result$candidates$.content)===null||_result$candidates$$c===void 0?void 0:(_result$candidates$$c2=_result$candidates$$c.parts)===null||_result$candidates$$c2===void 0?void 0:(_result$candidates$$c3=_result$candidates$$c2[0])===null||_result$candidates$$c3===void 0?void 0:_result$candidates$$c3.text;const jsonMatch=llmOutputText===null||llmOutputText===void 0?void 0:llmOutputText.match(/\\{[\\s\\S]*\\}/);if(jsonMatch)return JSON.parse(jsonMatch[0]);throw new Error(\"Valid JSON object not found in LLM response.\");}catch(error){console.error(\"LLM API call error:\",error);setLlmError(error.message||'LLM 호출 실패');return null;}finally{setIsTextLoading(false);}};const sendChatMessage=async()=>{if(!db||!userId||!isAuthReady||!currentChatMessage.trim())return;try{const chatCollectionRef=collection(db,'artifacts',appId,'public','data','chatMessages');await addDoc(chatCollectionRef,{userId,displayName:getDisplayName(userId),message:currentChatMessage,timestamp:serverTimestamp()});setCurrentChatMessage('');}catch(error){console.error(\"Error sending chat message:\",error);}};const updatePublicState=async(llmResponse,playerChoice)=>{const mainScenarioRef=getMainScenarioRef(db,appId);// [개선] groupStory도 이벤트 로그에 기록\nconst newEvent={actor:{id:userId,displayName:getDisplayName(userId)},action:playerChoice,publicStory:llmResponse.story||\"특별한 일은 일어나지 않았다.\",privateStories:{[userId]:llmResponse.privateStory||null},groupStory:llmResponse.groupStory||null,// 그룹 스토리 추가\ntimestamp:new Date()};await runTransaction(db,async transaction=>{var _llmResponse$sharedSt,_llmResponse$sharedSt2;const scenarioDoc=await transaction.get(mainScenarioRef);if(!scenarioDoc.exists())throw\"시나리오 문서가 없습니다.\";const currentData=scenarioDoc.data();const newStoryLog=[...(currentData.storyLog||[]),newEvent];transaction.update(mainScenarioRef,{storyLog:newStoryLog,choices:llmResponse.choices||[],'player.currentLocation':((_llmResponse$sharedSt=llmResponse.sharedStateUpdates)===null||_llmResponse$sharedSt===void 0?void 0:_llmResponse$sharedSt.location)||currentData.player.currentLocation,// [신규] subtleClues 업데이트\nsubtleClues:((_llmResponse$sharedSt2=llmResponse.sharedStateUpdates)===null||_llmResponse$sharedSt2===void 0?void 0:_llmResponse$sharedSt2.subtleClues)||currentData.subtleClues,lastUpdate:serverTimestamp()});});};const updatePrivateState=async llmResponse=>{const privateStateRef=getPrivatePlayerStateRef(db,appId,userId);// [개선] groupChoices와 새로운 상태들(groups, npcRelations)도 업데이트\nconst updates={...llmResponse.privateStateUpdates,choices:[...(llmResponse.privateChoices||[]),...(llmResponse.groupChoices||[])]};await setDoc(privateStateRef,updates,{merge:true});};// [신규] 선택지에 따른 행동 범위(scope)를 결정하는 헬퍼 함수\nconst getActionScope=choice=>{// 실제 구현에서는 더 정교한 파싱 로직이 필요합니다.\n// 여기서는 예시로 '대화'는 NPC, '탐색'이나 '이동'은 장소로 가정합니다.\nconst npcMatch=choice.match(/(.+)에게 말을 건다/);if(npcMatch){return`npc:${npcMatch[1].trim()}`;}// 더 많은 규칙 추가 가능\nreturn`location:${gameState.player.currentLocation}`;};const handleChoiceClick=async choice=>{if(isTextLoading)return;if(!privatePlayerState.characterCreated){setIsTextLoading(true);const choiceKey=choice.split('.')[0];const selectedProfession=professions[choiceKey];if(selectedProfession){const privateStateRef=getPrivatePlayerStateRef(db,appId,userId);await setDoc(privateStateRef,{...getDefaultPrivatePlayerState(),characterCreated:true,profession:selectedProfession.name,initialMotivation:selectedProfession.motivation},{merge:true});const mainScenarioRef=getMainScenarioRef(db,appId);const newEvent={actor:{id:userId,displayName:getDisplayName(userId)},action:\"여관에 들어선다\",publicStory:`어둠침침한 여관 문이 삐걱거리며 열리더니, 새로운 모험가가 모습을 드러냅니다. 바로 '${getDisplayName(userId)}'라는 이름의 ${selectedProfession.name}입니다.`,privateStories:{[userId]:selectedProfession.motivation},timestamp:new Date()};try{await runTransaction(db,async transaction=>{const scenarioDoc=await transaction.get(mainScenarioRef);const initialChoices=[\"여관을 둘러본다.\",\"다른 모험가에게 말을 건다.\",\"여관 주인에게 정보를 묻는다.\"];if(!scenarioDoc.exists()){transaction.set(mainScenarioRef,{...getDefaultGameState(),storyLog:[newEvent],choices:initialChoices,lastUpdate:serverTimestamp()});}else{const currentLog=scenarioDoc.data().storyLog||[];transaction.update(mainScenarioRef,{storyLog:[...currentLog,newEvent],choices:initialChoices,lastUpdate:serverTimestamp()});}});}catch(e){console.error(\"등장 이벤트 추가 실패: \",e);setLlmError(\"게임 세계에 합류하는 중 오류가 발생했습니다.\");}finally{setIsTextLoading(false);}}return;}const gameStatusRef=getGameStatusRef(db,appId);const scope=getActionScope(choice);setIsTextLoading(true);try{var _await$getDoc$data;// [개선] 지역 잠금 확인 및 설정\nconst currentLocks=((_await$getDoc$data=(await getDoc(gameStatusRef)).data())===null||_await$getDoc$data===void 0?void 0:_await$getDoc$data.actionLocks)||{};if(currentLocks[scope]&&currentLocks[scope]!==userId){throw new Error(`현재 '${scope.split(':')[1]}'(은)는 다른 플레이어(${getDisplayName(currentLocks[scope])})가 사용 중입니다.`);}await setDoc(gameStatusRef,{actionLocks:{...currentLocks,[scope]:userId}},{merge:true});const promptData={playerChoice:choice,sharedInfo:{currentLocation:gameState.player.currentLocation,subtleClues:gameState.subtleClues},privateInfo:privatePlayerState,history:gameState.log,activeUsers:activeUsers.map(u=>({nickname:getDisplayName(u.id),profession:u.profession})).filter(u=>u.id!==userId),worldHistory:worldHistory};const llmResponse=await callGeminiTextLLM(promptData);if(llmResponse){await updatePublicState(llmResponse,choice);await updatePrivateState(llmResponse);setLlmError(null);setLlmRetryPrompt(null);}else{if(!llmError){setLlmError(\"LLM으로부터 유효한 응답을 받지 못했습니다.\");}}}catch(error){console.error(\"행동 처리 중 오류:\",error.message);setLlmError(error.message);}finally{// [개선] 지역 잠금 해제\nconst finalLocksDoc=await getDoc(gameStatusRef);if(finalLocksDoc.exists()){const finalLocks=finalLocksDoc.data().actionLocks||{};if(finalLocks[scope]===userId){// 내가 건 잠금일 때만 해제\ndelete finalLocks[scope];await setDoc(gameStatusRef,{actionLocks:finalLocks},{merge:true});}}setIsTextLoading(false);}};const toggleAccordion=key=>{setAccordion(prev=>({...prev,[key]:!prev[key]}));};const LlmErrorModal=()=>/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-md space-y-4 text-center\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-xl font-bold text-red-400\",children:\"\\uC624\\uB958\\uAC00 \\uBC1C\\uC0DD\\uD588\\uC2B5\\uB2C8\\uB2E4\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-200\",children:llmError}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-center gap-4\",children:[llmRetryPrompt&&/*#__PURE__*/_jsx(\"button\",{className:\"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-md\",onClick:async()=>{setLlmError(null);if(llmRetryPrompt.playerChoice){await handleChoiceClick(llmRetryPrompt.playerChoice);}},children:\"\\uC7AC\\uC2DC\\uB3C4\"}),/*#__PURE__*/_jsx(\"button\",{className:\"px-4 py-2 bg-gray-600 hover:bg-gray-700 font-bold rounded-md\",onClick:()=>{setLlmError(null);setLlmRetryPrompt(null);},children:\"\\uB2EB\\uAE30\"})]})]})});if(showNicknameModal){return/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-md space-y-4\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-xl font-bold text-gray-100\",children:\"\\uB2C9\\uB124\\uC784\\uC744 \\uC785\\uB825\\uD558\\uC138\\uC694\"}),/*#__PURE__*/_jsx(\"input\",{className:\"w-full p-3 rounded-md bg-gray-700 border border-gray-600 text-gray-100 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 text-lg\",placeholder:\"\\uB2C9\\uB124\\uC784\",value:nicknameInput,onChange:e=>setNicknameInput(e.target.value),onKeyDown:e=>{if(e.key==='Enter')handleNicknameSubmit();},autoFocus:true}),/*#__PURE__*/_jsx(\"button\",{className:\"w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-md transition duration-300 disabled:opacity-50\",onClick:handleNicknameSubmit,disabled:!nicknameInput.trim(),children:\"\\uC2DC\\uC791\\uD558\\uAE30\"})]})});}if(isLoading){return/*#__PURE__*/_jsxs(\"div\",{className:\"min-h-screen bg-gray-900 text-gray-100 flex items-center justify-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-16 w-16 border-b-2 border-gray-300\"}),/*#__PURE__*/_jsx(\"span\",{className:\"ml-4 text-xl\",children:\"\\uB370\\uC774\\uD130\\uB97C \\uBD88\\uB7EC\\uC624\\uB294 \\uC911...\"})]});}return/*#__PURE__*/_jsxs(\"div\",{className:\"min-h-screen bg-gray-900 text-gray-100 flex flex-col items-center justify-center p-4 font-sans\",children:[llmError&&/*#__PURE__*/_jsx(LlmErrorModal,{}),showResetModal&&/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-md space-y-4\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-xl font-bold text-red-400\",children:\"\\u26A0\\uFE0F \\uBAA8\\uB4E0 \\uB370\\uC774\\uD130\\uB97C \\uCD08\\uAE30\\uD654\\uD560\\uAE4C\\uC694?\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-200\",children:\"\\uC774 \\uC791\\uC5C5\\uC740 \\uB418\\uB3CC\\uB9B4 \\uC218 \\uC5C6\\uC2B5\\uB2C8\\uB2E4. \\uBAA8\\uB4E0 \\uC2DC\\uB098\\uB9AC\\uC624, \\uB85C\\uADF8, \\uC720\\uC800, \\uCC44\\uD305 \\uB370\\uC774\\uD130\\uAC00 \\uC0AD\\uC81C\\uB429\\uB2C8\\uB2E4.\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-end gap-3\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"px-4 py-2 bg-gray-600 hover:bg-gray-700 font-bold rounded-md\",onClick:()=>setShowResetModal(false),disabled:isResetting,children:\"\\uCDE8\\uC18C\"}),/*#__PURE__*/_jsx(\"button\",{className:\"px-4 py-2 bg-red-600 hover:bg-red-700 font-bold rounded-md\",onClick:resetAllGameData,disabled:isResetting,children:isResetting?'초기화 중...':'초기화'})]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"w-full max-w-5xl bg-gray-800 rounded-lg shadow-xl p-6 md:p-8 flex flex-col lg:flex-row space-y-6 lg:space-y-0 lg:space-x-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col w-full lg:w-2/3 space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-2\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between cursor-pointer select-none\",onClick:()=>toggleAccordion('gameLog'),children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-lg font-bold text-gray-100\",children:\"\\uAC8C\\uC784 \\uB85C\\uADF8\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xl\",children:accordion.gameLog?'▼':'▲'})]}),accordion.gameLog&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-end mb-2\",children:/*#__PURE__*/_jsx(\"button\",{className:\"px-3 py-1 bg-red-600 hover:bg-red-700 text-white text-xs rounded-md\",onClick:()=>setShowResetModal(true),children:\"\\uC804\\uCCB4 \\uB370\\uC774\\uD130 \\uCD08\\uAE30\\uD654\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-grow bg-gray-700 p-4 rounded-md overflow-y-auto h-96 custom-scrollbar text-sm md:text-base leading-relaxed\",style:{maxHeight:'24rem'},children:[!privatePlayerState.characterCreated&&/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4 p-2 rounded bg-gray-900/50 text-center\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-yellow-300 font-semibold italic text-lg\",children:\"\\uBAA8\\uD5D8\\uC758 \\uC11C\\uB9C9\"}),/*#__PURE__*/_jsx(\"p\",{className:\"whitespace-pre-wrap mt-1\",children:\"\\uB2F9\\uC2E0\\uC740 \\uC5B4\\uB5A4 \\uC6B4\\uBA85\\uC744 \\uC120\\uD0DD\\uD558\\uC2DC\\uACA0\\uC2B5\\uB2C8\\uAE4C?\"})]}),gameState.log.map((event,index)=>{var _event$actor;return/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4 p-2 rounded bg-gray-900/50\",children:[((_event$actor=event.actor)===null||_event$actor===void 0?void 0:_event$actor.displayName)&&event.action&&/*#__PURE__*/_jsxs(\"p\",{className:\"text-yellow-300 font-semibold italic text-sm\",children:[event.actor.displayName,\" \\uB2D8\\uC774 \",event.action,\" \\uC120\\uD0DD\"]}),/*#__PURE__*/_jsx(\"p\",{className:\"whitespace-pre-wrap mt-1\",dangerouslySetInnerHTML:{__html:(event.publicStory||'').replace(/\\n/g,'<br />')}}),event.groupStory&&privatePlayerState.groups.length>0&&/*#__PURE__*/_jsxs(\"p\",{className:\"whitespace-pre-wrap mt-2 p-2 rounded bg-green-900/30 border-l-4 border-green-400 text-green-200\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-bold\",children:\"[\\uADF8\\uB8F9 \\uC774\\uC57C\\uAE30] \"}),event.groupStory]}),event.privateStories&&event.privateStories[userId]&&/*#__PURE__*/_jsxs(\"p\",{className:\"whitespace-pre-wrap mt-2 p-2 rounded bg-blue-900/30 border-l-4 border-blue-400 text-blue-200\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-bold\",children:\"[\\uB2F9\\uC2E0\\uB9CC \\uC544\\uB294 \\uC0AC\\uC2E4] \"}),event.privateStories[userId]]})]},index);}),isTextLoading&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-center items-center mt-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-300\"}),/*#__PURE__*/_jsx(\"span\",{className:\"ml-3 text-gray-400\",children:\"\\uC774\\uC57C\\uAE30\\uB97C \\uC0DD\\uC131 \\uC911...\"})]}),Object.entries(actionLocks).map(_ref=>{let[scope,lockedBy]=_ref;if(lockedBy===userId)return null;// 내가 건 잠금은 표시 안함\nreturn/*#__PURE__*/_jsx(\"div\",{className:\"text-center text-yellow-400 font-semibold p-2 bg-black bg-opacity-20 rounded-md mt-2\",children:`'${scope.split(':')[1]}' 영역은 ${getDisplayName(lockedBy)}님이 사용 중입니다...`},scope);}),/*#__PURE__*/_jsx(\"div\",{ref:logEndRef})]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex flex-col gap-3\",children:privatePlayerState.characterCreated?[...gameState.choices,...(privatePlayerState.choices||[])].map((choice,index)=>{// [개선] 선택지 버튼 로직: 지역 잠금 및 그룹 선택지 구분\nconst scope=getActionScope(choice);const isLockedByOther=actionLocks[scope]&&actionLocks[scope]!==userId;const allPrivateChoices=privatePlayerState.choices||[];const isPersonalChoice=allPrivateChoices.includes(choice);const isPublicChoice=gameState.choices.includes(choice);let buttonStyle='bg-blue-600 hover:bg-blue-700';// Public\nlet prefix='';if(isPersonalChoice&&!isPublicChoice){buttonStyle='bg-green-600 hover:bg-green-700';// Group/Private\nprefix='[개인/그룹] ';}if(isLockedByOther){buttonStyle='bg-gray-500 cursor-not-allowed';prefix=`[${getDisplayName(actionLocks[scope])} 사용 중] `;}return/*#__PURE__*/_jsxs(\"button\",{className:`px-6 py-3 font-bold rounded-md shadow-lg transition duration-300 disabled:opacity-50 ${buttonStyle} text-white`,onClick:()=>handleChoiceClick(choice),disabled:isTextLoading||isLockedByOther,children:[prefix,choice]},index);}):Object.keys(professions).map(key=>/*#__PURE__*/_jsxs(\"button\",{onClick:()=>handleChoiceClick(`${key}. ${professions[key].name}`),disabled:isTextLoading,className:\"px-6 py-4 bg-gray-800 hover:bg-gray-700 border border-gray-600 text-white font-bold rounded-md shadow-lg transition duration-300 disabled:opacity-50 disabled:cursor-wait text-left\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-lg text-blue-300\",children:`${key}. ${professions[key].name}`}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-normal text-gray-300 mt-1\",children:professions[key].motivation})]},key))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"w-full lg:w-1/3 flex flex-col space-y-6 bg-gray-700 p-4 rounded-lg shadow-inner\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-2\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between cursor-pointer select-none\",onClick:()=>toggleAccordion('playerInfo'),children:[/*#__PURE__*/_jsx(\"h4\",{className:\"text-md font-semibold text-gray-200\",children:\"\\uB0B4 \\uC815\\uBCF4\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xl\",children:accordion.playerInfo?'▼':'▲'})]}),accordion.playerInfo&&/*#__PURE__*/// [개선] 내 정보 UI에 신규 기능 반영\n_jsxs(\"div\",{className:\"bg-gray-600 p-3 rounded-md text-xs md:text-sm text-gray-300 space-y-1 h-48 overflow-y-auto custom-scrollbar\",children:[/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold text-blue-300\",children:\"\\uC774\\uB984:\"}),\" \",getDisplayName(userId)]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold text-blue-300\",children:\"\\uC9C1\\uC5C5:\"}),\" \",privatePlayerState.profession||'미정']}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold text-blue-300\",children:\"\\uC704\\uCE58:\"}),\" \",gameState.player.currentLocation]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold text-blue-300\",children:\"\\uB2A5\\uB825\\uCE58:\"}),\" \\uD798(\",privatePlayerState.stats.strength,\") \\uC9C0\\uB2A5(\",privatePlayerState.stats.intelligence,\") \\uBBFC\\uCCA9(\",privatePlayerState.stats.agility,\") \\uCE74\\uB9AC\\uC2A4\\uB9C8(\",privatePlayerState.stats.charisma,\")\"]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold text-blue-300\",children:\"\\uC778\\uBCA4\\uD1A0\\uB9AC:\"}),\" \",privatePlayerState.inventory.join(', ')||'비어있음']}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold text-blue-300\",children:\"\\uD018\\uC2A4\\uD2B8:\"}),\" \",privatePlayerState.activeQuests.join(', ')||'없음']}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold text-blue-300\",children:\"\\uB2E8\\uC11C:\"}),\" \",privatePlayerState.knownClues.join(', ')||'없음']}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold text-green-300\",children:\"\\uC18C\\uC18D \\uADF8\\uB8F9:\"}),\" \",privatePlayerState.groups.join(', ')||'없음']}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold text-yellow-300\",children:\"NPC \\uAD00\\uACC4:\"}),/*#__PURE__*/_jsx(\"ul\",{className:\"list-disc list-inside ml-4\",children:Object.entries(privatePlayerState.npcRelations).length>0?Object.entries(privatePlayerState.npcRelations).map(_ref2=>{let[name,value]=_ref2;return/*#__PURE__*/_jsx(\"li\",{children:`${name}: ${value}`},name);}):/*#__PURE__*/_jsx(\"li\",{children:\"\\uC54C\\uB824\\uC9C4 \\uAD00\\uACC4 \\uC5C6\\uC74C\"})})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-2\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between cursor-pointer select-none\",onClick:()=>toggleAccordion('users'),children:[/*#__PURE__*/_jsx(\"h4\",{className:\"text-md font-semibold text-gray-200\",children:\"\\uD604\\uC7AC \\uD50C\\uB808\\uC774\\uC5B4\\uB4E4\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xl\",children:accordion.users?'▼':'▲'})]}),accordion.users&&/*#__PURE__*/_jsx(\"div\",{className:\"bg-gray-600 p-3 rounded-md h-48 overflow-y-auto custom-scrollbar\",children:activeUsers.length>0?/*#__PURE__*/_jsx(\"ul\",{className:\"text-sm text-gray-300 space-y-1\",children:activeUsers.map(user=>/*#__PURE__*/_jsxs(\"li\",{className:\"truncate p-1 rounded-md\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium text-green-300\",children:getDisplayName(user.id)}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-gray-400 text-xs\",children:[\" (\",user.profession||'모험가',\")\"]})]},user.id))}):/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-400\",children:\"\\uD65C\\uB3D9 \\uC911\\uC778 \\uD50C\\uB808\\uC774\\uC5B4\\uAC00 \\uC5C6\\uC2B5\\uB2C8\\uB2E4.\"})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-2\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between cursor-pointer select-none\",onClick:()=>toggleAccordion('chat'),children:[/*#__PURE__*/_jsx(\"h4\",{className:\"text-md font-semibold text-gray-200\",children:\"\\uACF5\\uAC1C \\uCC44\\uD305\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xl\",children:accordion.chat?'▼':'▲'})]}),accordion.chat&&/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gray-600 p-3 rounded-md flex flex-col h-64\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex-grow overflow-y-auto custom-scrollbar mb-3 text-sm space-y-2\",children:[chatMessages.map(msg=>/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsxs(\"span\",{className:\"font-medium text-yellow-300\",children:[getDisplayName(msg.userId),\":\"]}),\" \",msg.message]})},msg.id)),/*#__PURE__*/_jsx(\"div\",{ref:chatEndRef})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"flex-grow p-2 rounded-l-md bg-gray-700 border border-gray-600\",value:currentChatMessage,onChange:e=>setCurrentChatMessage(e.target.value),onKeyPress:e=>e.key==='Enter'&&sendChatMessage(),disabled:!isAuthReady}),/*#__PURE__*/_jsx(\"button\",{className:\"px-4 py-2 bg-blue-600 hover:bg-blue-700 font-bold rounded-r-md\",onClick:sendChatMessage,disabled:!isAuthReady||!currentChatMessage.trim(),children:\"\\uBCF4\\uB0B4\\uAE30\"})]})]})]})]})]}),/*#__PURE__*/_jsx(\"style\",{children:`\n        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap');\n        body { font-family: 'Noto Sans KR', sans-serif; }\n        .custom-scrollbar::-webkit-scrollbar { width: 8px; }\n        .custom-scrollbar::-webkit-scrollbar-track { background: #4a5568; border-radius: 10px; }\n        .custom-scrollbar::-webkit-scrollbar-thumb { background: #6b7280; border-radius: 10px; }\n        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #9ca3af; }\n        `})]});}export default App;","map":{"version":3,"names":["React","useState","useEffect","useRef","initializeApp","getAuth","signInAnonymously","signInWithCustomToken","onAuthStateChanged","getFirestore","doc","setDoc","getDoc","collection","query","onSnapshot","serverTimestamp","addDoc","getDocs","deleteDoc","runTransaction","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","defaultFirebaseConfig","apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId","measurementId","firebaseConfig","initialAuthToken","professions","name","motivation","getMainScenarioRef","db","getPrivatePlayerStateRef","userId","getGameStatusRef","getMajorEventsRef","getDefaultGameState","phase","log","choices","player","currentLocation","subtleClues","getDefaultPrivatePlayerState","stats","strength","intelligence","agility","charisma","inventory","initialMotivation","reputation","activeQuests","companions","knownClues","characterCreated","profession","groups","npcRelations","App","gameState","setGameState","privatePlayerState","setPrivatePlayerState","isTextLoading","setIsTextLoading","activeUsers","setActiveUsers","chatMessages","setChatMessages","currentChatMessage","setCurrentChatMessage","actionLocks","setActionLocks","setDb","auth","setAuth","setUserId","isAuthReady","setIsAuthReady","logEndRef","chatEndRef","nickname","setNickname","localStorage","getItem","showNicknameModal","setShowNicknameModal","nicknameInput","setNicknameInput","accordion","setAccordion","gameLog","chat","users","playerInfo","showResetModal","setShowResetModal","isResetting","setIsResetting","llmError","setLlmError","llmRetryPrompt","setLlmRetryPrompt","isLoading","setIsLoading","worldHistory","setWorldHistory","handleNicknameSubmit","trim","finalNickname","setItem","userDocRef","merge","getDisplayName","uid","substring","user","find","u","id","resetAllGameData","majorEventsRef","majorEventsSnapshot","docSnap","docs","ref","e","console","error","window","location","reload","app","firestoreDb","firebaseAuth","unsubscribeAuth","setupPlayerState","privateStateRef","exists","unsubscribe","snapshot","data","err","unsubscribePromise","then","unsub","gameStatusRef","unsubscribeGameStatus","_docSnap$data","chatMessagesColRef","unsubscribeChat","messages","map","d","sort","a","b","_a$timestamp","_b$timestamp","timestamp","toMillis","activeUsersColRef","unsubscribeActiveUsers","cutoffTime","Date","now","filter","lastActive","mainScenarioRef","unsubscribeMainScenario","snap","prev","_data$player","storyLog","fetchHistory","historySnapshot","historyData","summary","updateUserPresence","handleVisibilityChange","document","visibilityState","addEventListener","removeEventListener","current","scrollIntoView","behavior","systemPrompt","callGeminiTextLLM","promptData","mainApiKey","backupApiKey","getApiUrl","history","event","publicStory","slice","userPrompt","length","join","sharedInfo","JSON","stringify","privateInfo","playerChoice","payload","contents","role","parts","text","tryGeminiCall","fetch","method","headers","body","_result$candidates","_result$candidates$","_result$candidates$$c","_result$candidates$$c2","_result$candidates$$c3","response","ok","Error","status","result","json","llmOutputText","candidates","content","jsonMatch","match","parse","message","sendChatMessage","chatCollectionRef","displayName","updatePublicState","llmResponse","newEvent","actor","action","story","privateStories","privateStory","groupStory","transaction","_llmResponse$sharedSt","_llmResponse$sharedSt2","scenarioDoc","get","currentData","newStoryLog","update","sharedStateUpdates","lastUpdate","updatePrivateState","updates","privateStateUpdates","privateChoices","groupChoices","getActionScope","choice","npcMatch","handleChoiceClick","choiceKey","split","selectedProfession","initialChoices","set","currentLog","scope","_await$getDoc$data","currentLocks","finalLocksDoc","finalLocks","toggleAccordion","key","LlmErrorModal","className","children","onClick","placeholder","value","onChange","target","onKeyDown","autoFocus","disabled","style","maxHeight","index","_event$actor","dangerouslySetInnerHTML","__html","replace","Object","entries","_ref","lockedBy","isLockedByOther","allPrivateChoices","isPersonalChoice","includes","isPublicChoice","buttonStyle","prefix","keys","_ref2","msg","type","onKeyPress"],"sources":["/workspace/src/App.jsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport { initializeApp } from 'firebase/app';\nimport {\n  getAuth,\n  signInAnonymously,\n  signInWithCustomToken,\n  onAuthStateChanged\n} from 'firebase/auth';\nimport {\n  getFirestore,\n  doc,\n  setDoc,\n  getDoc,\n  collection,\n  query,\n  onSnapshot,\n  serverTimestamp,\n  addDoc,\n  getDocs,\n  deleteDoc,\n  runTransaction\n} from 'firebase/firestore';\n\n// ====================================================================\n// Firebase configuration information - 수정 금지\nconst defaultFirebaseConfig = {\n  apiKey: \"AIzaSyBNJtmpRWzjobrY556bnHkwbZmpFJqgPX8\",\n  authDomain: \"text-adventure-game-cb731.firebaseapp.com\",\n  projectId: \"text-adventure-game-cb731\",\n  storageBucket: \"text-adventure-game-cb731.appspot.com\",\n  messagingSenderId: \"1092941614820\",\n  appId: \"1:1092941614820:web:5545f36014b73c268026f1\",\n  measurementId: \"G-FNGF42T1FP\"\n};\n\n// 수정금지\nconst firebaseConfig = defaultFirebaseConfig;\nconst appId = firebaseConfig.projectId;\nconst initialAuthToken = null;\n// ====================================================================\n\nconst professions = {\n  '1': { name: '몰락한 귀족/기사', motivation: '가문의 몰락 원인을 조사하고, 잃어버린 가문의 보물을 찾아야 합니다.' },\n  '2': { name: '평범한 마을 사람/농부', motivation: '갑자기 마을에 나타난 괴생명체로부터 마을을 지켜야 합니다.' },\n  '3': { name: '젊은 마법사/견습생', motivation: '스승님의 실종에 대한 단서를 찾아야 합니다.' },\n  '4': { name: '용병/모험가', motivation: '의뢰받은 임무를 수행하던 중 예상치 못한 사건에 휘말렸습니다.' },\n  '5': { name: '도적/암살자', motivation: '길드에서 내려온 첫 번째 임무를 완수하고, 그 과정에서 수상한 음모를 감지해야 합니다.' },\n  '6': { name: '왕족/공주/왕자', motivation: '왕실 내의 불화와 암투 속에서 자신의 입지를 다져야 합니다.' },\n};\n\n// Firestore 경로 유틸\nconst getMainScenarioRef = (db, appId) => doc(db, 'artifacts', appId, 'public', 'data', 'mainScenario', 'main');\nconst getPrivatePlayerStateRef = (db, appId, userId) => doc(db, 'artifacts', appId, 'users', userId, 'playerState', 'state');\n// [신규] 게임 상태(잠금 등) 경로 유틸\nconst getGameStatusRef = (db, appId) => doc(db, 'artifacts', appId, 'public', 'data', 'gameStatus', 'status');\n// [신규] 세상의 주요 역사 경로 유틸\nconst getMajorEventsRef = (db, appId) => collection(db, 'artifacts', appId, 'public', 'data', 'majorEvents');\n\n\n// [개선] 상태 초기화 유틸: 신규 기능 반영\nconst getDefaultGameState = () => ({\n  phase: 'playing',\n  log: [],\n  choices: [],\n  player: {\n    currentLocation: '방랑자의 안식처',\n  },\n  subtleClues: [], // [신규] 세상에 남겨진 미세한 흔적들\n});\n\nconst getDefaultPrivatePlayerState = () => ({\n    stats: { strength: 10, intelligence: 10, agility: 10, charisma: 10 },\n    inventory: [],\n    initialMotivation: '',\n    reputation: {}, // 세력 평판은 유지\n    activeQuests: [],\n    companions: [],\n    knownClues: [],\n    characterCreated: false,\n    profession: '',\n    choices: [],\n    groups: [], // [신규] 소속 그룹\n    npcRelations: {}, // [신규] 개별 NPC 관계도\n});\n\n\nfunction App() {\n  const [gameState, setGameState] = useState(getDefaultGameState());\n  const [privatePlayerState, setPrivatePlayerState] = useState(getDefaultPrivatePlayerState());\n  const [isTextLoading, setIsTextLoading] = useState(false);\n  const [activeUsers, setActiveUsers] = useState([]);\n  const [chatMessages, setChatMessages] = useState([]);\n  const [currentChatMessage, setCurrentChatMessage] = useState('');\n  // [개선] 전역 잠금(isActionInProgress, actingPlayer) 대신 지역 잠금(actionLocks) 상태 사용\n  const [actionLocks, setActionLocks] = useState({});\n  const [db, setDb] = useState(null);\n  const [auth, setAuth] = useState(null);\n  const [userId, setUserId] = useState(null);\n  const [isAuthReady, setIsAuthReady] = useState(false);\n  const logEndRef = useRef(null);\n  const chatEndRef = useRef(null);\n  const [nickname, setNickname] = useState(() => localStorage.getItem('nickname') || '');\n  const [showNicknameModal, setShowNicknameModal] = useState(!localStorage.getItem('nickname'));\n  const [nicknameInput, setNicknameInput] = useState('');\n  const [accordion, setAccordion] = useState({ gameLog: true, chat: true, users: true, playerInfo: true });\n  const [showResetModal, setShowResetModal] = useState(false);\n  const [isResetting, setIsResetting] = useState(false);\n  const [llmError, setLlmError] = useState(null);\n  const [llmRetryPrompt, setLlmRetryPrompt] = useState(null);\n  const [isLoading, setIsLoading] = useState(true);\n  // [신규] 세상의 역사를 저장할 상태\n  const [worldHistory, setWorldHistory] = useState([]);\n\n  const handleNicknameSubmit = () => {\n    if (nicknameInput.trim()) {\n      const finalNickname = nicknameInput.trim();\n      setNickname(finalNickname);\n      localStorage.setItem('nickname', finalNickname);\n      setShowNicknameModal(false);\n      if (userId && db) {\n          const userDocRef = doc(db, 'artifacts', appId, 'public', 'data', 'activeUsers', userId);\n          setDoc(userDocRef, { nickname: finalNickname }, { merge: true });\n      }\n    }\n  };\n\n  const getDisplayName = (uid) => {\n    if (uid === userId) return nickname || `플레이어 ${userId?.substring(0, 4)}`;\n    const user = activeUsers.find(u => u.id === uid);\n    return user?.nickname || `플레이어 ${uid?.substring(0, 4)}`;\n  };\n\n  const resetAllGameData = async () => {\n    if (!db || !isAuthReady) return;\n    setIsResetting(true);\n    try {\n        // ... (기존 리셋 로직과 동일)\n        // [신규] 추가된 컬렉션도 삭제 대상에 포함 가능\n        const majorEventsRef = getMajorEventsRef(db, appId);\n        const majorEventsSnapshot = await getDocs(majorEventsRef);\n        for (const docSnap of majorEventsSnapshot.docs) {\n            await deleteDoc(docSnap.ref);\n        }\n    } catch (e) {\n        console.error(\"Data reset error:\", e);\n    } finally {\n      setIsResetting(false);\n      setShowResetModal(false);\n      window.location.reload();\n    }\n  };\n\n  useEffect(() => {\n    try {\n      const app = initializeApp(firebaseConfig);\n      const firestoreDb = getFirestore(app);\n      const firebaseAuth = getAuth(app);\n      setDb(firestoreDb);\n      setAuth(firebaseAuth);\n      const unsubscribeAuth = onAuthStateChanged(firebaseAuth, async (user) => {\n        if (user) {\n          setUserId(user.uid);\n          setIsAuthReady(true);\n        } else {\n            await (initialAuthToken ? signInWithCustomToken(firebaseAuth, initialAuthToken) : signInAnonymously(firebaseAuth));\n        }\n      });\n      return () => unsubscribeAuth();\n    } catch (error) {\n      console.error(\"Firebase initialization error:\", error);\n      setLlmError(\"Firebase 초기화에 실패했습니다.\");\n    }\n  }, []);\n\n  useEffect(() => {\n    if (!db || !userId || !isAuthReady) return;\n\n    const setupPlayerState = async () => {\n      setIsLoading(true);\n      const privateStateRef = getPrivatePlayerStateRef(db, appId, userId);\n      try {\n        const docSnap = await getDoc(privateStateRef);\n\n        if (!docSnap.exists()) {\n          // [개선] 신규 기능이 반영된 기본 상태로 초기화\n          await setDoc(privateStateRef, getDefaultPrivatePlayerState());\n        }\n\n        const unsubscribe = onSnapshot(privateStateRef, (snapshot) => {\n          if (snapshot.exists()) {\n            // [개선] 신규 기능이 반영된 기본 상태와 병합\n            setPrivatePlayerState({ ...getDefaultPrivatePlayerState(), ...snapshot.data() });\n            setIsLoading(false);\n          }\n        }, (err) => {\n          console.error(\"실시간 데이터 수신 오류:\", err);\n          setLlmError(\"데이터 수신 중 오류가 발생했습니다.\");\n          setIsLoading(false);\n        });\n        return unsubscribe;\n\n      } catch (error) {\n        console.error(\"플레이어 상태 설정 오류:\", error);\n        setLlmError(\"플레이어 정보를 가져오는 데 실패했습니다.\");\n        setIsLoading(false);\n      }\n    };\n\n    let unsubscribePromise = setupPlayerState();\n\n    return () => {\n      unsubscribePromise.then(unsub => {\n        if (unsub) unsub();\n      });\n    };\n  }, [db, userId, isAuthReady]);\n\n\n  useEffect(() => {\n    if (isLoading || !db || !isAuthReady || !userId || !auth) return;\n    if (!privatePlayerState.characterCreated) return;\n\n    // [개선] 게임 상태 리스너: 지역 잠금(actionLocks) 상태를 실시간으로 동기화\n    const gameStatusRef = getGameStatusRef(db, appId);\n    const unsubscribeGameStatus = onSnapshot(gameStatusRef, (docSnap) => {\n      setActionLocks(docSnap.data()?.actionLocks || {});\n    });\n\n    const chatMessagesColRef = collection(db, 'artifacts', appId, 'public', 'data', 'chatMessages');\n    const unsubscribeChat = onSnapshot(query(chatMessagesColRef), (snapshot) => {\n        const messages = snapshot.docs.map(d => ({ id: d.id, ...d.data() })).sort((a, b) => (a.timestamp?.toMillis() || 0) - (b.timestamp?.toMillis() || 0));\n        setChatMessages(messages);\n    });\n\n    const activeUsersColRef = collection(db, 'artifacts', appId, 'public', 'data', 'activeUsers');\n    const unsubscribeActiveUsers = onSnapshot(query(activeUsersColRef), (snapshot) => {\n      const cutoffTime = Date.now() - 60 * 1000;\n      const users = snapshot.docs.map(d => ({ id: d.id, ...d.data() })).filter(u => u.lastActive && u.lastActive.toMillis() > cutoffTime);\n      setActiveUsers(users);\n    });\n\n    // [개선] 메인 시나리오 리스너: subtleClues(미세한 흔적)도 함께 동기화\n    const mainScenarioRef = getMainScenarioRef(db, appId);\n    const unsubscribeMainScenario = onSnapshot(mainScenarioRef, (snap) => {\n      if (snap.exists()) {\n        const data = snap.data();\n        setGameState(prev => ({\n          ...prev,\n          log: data.storyLog || [],\n          choices: data.choices || [],\n          player: { ...prev.player, currentLocation: data.player?.currentLocation || prev.player.currentLocation },\n          subtleClues: data.subtleClues || []\n        }));\n      }\n    }, (error) => {\n      console.error(\"Main scenario snapshot error:\", error);\n      setLlmError(\"시나리오를 불러오는 중 오류가 발생했습니다.\");\n    });\n\n    // [신규] 세상의 주요 역사 데이터 불러오기 (실제 앱에서는 필요에 따라 로드)\n    const fetchHistory = async () => {\n      const historySnapshot = await getDocs(getMajorEventsRef(db, appId));\n      const historyData = historySnapshot.docs.map(doc => doc.data().summary);\n      setWorldHistory(historyData);\n    };\n    fetchHistory();\n\n    return () => {\n      unsubscribeGameStatus();\n      unsubscribeChat();\n      unsubscribeActiveUsers();\n      unsubscribeMainScenario();\n    };\n  }, [db, isAuthReady, userId, auth, isLoading, privatePlayerState.characterCreated]);\n\n  useEffect(() => {\n    if (!db || !userId || !nickname) return;\n\n    const updateUserPresence = async () => {\n      const userDocRef = doc(db, 'artifacts', appId, 'public', 'data', 'activeUsers', userId);\n      await setDoc(userDocRef, {\n        lastActive: serverTimestamp(),\n        nickname: nickname || `플레이어 ${userId.substring(0, 4)}`,\n        profession: privatePlayerState.profession,\n      }, { merge: true });\n    };\n\n    const handleVisibilityChange = () => {\n      if (document.visibilityState === 'visible') {\n        updateUserPresence();\n      }\n    };\n\n    document.addEventListener('visibilitychange', handleVisibilityChange);\n    updateUserPresence();\n\n    return () => {\n      document.removeEventListener('visibilitychange', handleVisibilityChange);\n    };\n  }, [db, userId, nickname, privatePlayerState.profession]);\n\n  useEffect(() => {\n    if (accordion.gameLog && logEndRef.current) logEndRef.current.scrollIntoView({ behavior: \"smooth\" });\n  }, [gameState.log, accordion.gameLog]);\n\n  useEffect(() => {\n    if (accordion.chat && chatEndRef.current) chatEndRef.current.scrollIntoView({ behavior: \"smooth\" });\n  }, [chatMessages, accordion.chat]);\n\n  // [개선] 시스템 프롬프트: 우리의 모든 아이디어를 반영하여 대폭 수정\n  const systemPrompt = `\n    ### 페르소나 (Persona)\n    당신은 세계 최고의 TRPG '게임 마스터(GM)'입니다. 당신의 임무는 유기적으로 살아 숨 쉬는 세계를 창조하는 것입니다. 플레이어의 선택은 세상에 영구적인 흔적을 남기고, 다른 플레이어의 경험에 영향을 미치며, 세상의 역사를 바꾸어야 합니다.\n\n    ### 핵심 철학: 다층적 서사 (Multi-layered Narrative)\n    1.  **공유된 현실 (Shared Reality):** 세상의 중요한 사건, 장소의 변화 등은 모든 플레이어가 함께 경험하는 절대적인 현실입니다. ('story', 'sharedStateUpdates')\n    2.  **개인적 서사 (Personal Narrative):** 플레이어의 내면, 비밀 지식, 개인 퀘스트 등은 오직 그 플레이어에게만 주어지는 고유한 경험입니다. ('privateStory', 'privateChoices')\n    3.  **[신규] 그룹 서사 (Group Narrative):** 같은 그룹(길드, 파티 등)에 소속된 플레이어들만 공유하는 비밀스러운 이야기입니다. ('groupStory', 'groupChoices')\n\n    ### 스토리텔링 원칙\n    * **살아있는 세계:** 플레이어의 행동은 세상에 '미세한 흔적(subtleClues)'을 남겨 다른 플레이어가 발견할 수 있게 하십시오. 'NPC 관계도(npcRelations)'에 따라 NPC들의 반응이 달라져야 하며, '세상의 주요 역사(worldHistory)'는 현재의 사건에 영향을 미쳐야 합니다.\n    * **역할 존중:** 플레이어의 직업, 능력치, 아이템, 소속 그룹, 그리고 '개인 정보'는 당신이 스토리를 만들 때 가장 먼저 고려해야 할 재료입니다.\n\n    ### JSON 출력 규칙 (매우 중요)\n    당신은 반드시 아래의 JSON 구조를 완벽하게 따라야 합니다. 설명(comment)은 절대 포함하지 마십시오.\n    {\n      \"story\": \"모든 플레이어가 볼 수 있는 공유된 사건에 대한 3인칭 서사.\",\n      \"privateStory\": \"선택을 한 플레이어만 볼 수 있는 2인칭 서사. 내면의 생각, 감각 등을 묘사.\",\n      \"groupStory\": \"같은 그룹 소속원들만 볼 수 있는 비밀스러운 이야기. 해당사항 없으면 null.\",\n      \"choices\": [\"다른 플레이어들도 선택할 수 있는 일반적인 행동들.\"],\n      \"privateChoices\": [\"오직 이 플레이어의 특성 때문에 가능한 특별한 행동들.\"],\n      \"groupChoices\": [\"같은 그룹 소속원들만 할 수 있는 비밀 행동들.\"],\n      \"sharedStateUpdates\": {\n        \"location\": \"플레이어 그룹의 현재 위치. 변경되었을 경우에만 포함.\",\n        \"subtleClues\": [\n            {\"location\": \"장소명\", \"clue\": \"새롭게 생성된 단서\", \"timestamp\": \"ISO8601 형식 시간\"}\n        ]\n      },\n      \"privateStateUpdates\": {\n        \"inventory\": [\"업데이트된 전체 인벤토리 목록\"],\n        \"stats\": {\"strength\": 12, \"intelligence\": 10, \"agility\": 10, \"charisma\": 10 },\n        \"activeQuests\": [\"업데이트된 개인 퀘스트 목록\"],\n        \"knownClues\": [\"새롭게 알게 된 단서를 포함한 전체 단서 목록\"],\n        \"groups\": [\"업데이트된 전체 소속 그룹 목록\"],\n        \"npcRelations\": {\"가라크\": 55, \"엘라라\": -10}\n      }\n    }\n\n    ### 규칙 상세\n    * **상태 업데이트:** privateStateUpdates의 모든 필드는 항상 현재 플레이어의 전체 상태를 포함하여 보내야 합니다.\n    * 'story', 'privateStory', 'groupStory'는 합쳐서 500자 이내로 간결하게 작성하십시오.\n  `;\n\n  const callGeminiTextLLM = async (promptData) => {\n    setIsTextLoading(true);\n    setLlmRetryPrompt(promptData);\n    const mainApiKey = \"AIzaSyDC11rqjU30OJnLjaBFOaazZV0klM5raU8\"; // 보안상 실제 앱에서는 서버에서 관리해야 합니다.\n    const backupApiKey = \"AIzaSyAhscNjW8GmwKPuKzQ47blCY_bDanR-B84\";\n    const getApiUrl = (apiKey) => `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;\n\n    const history = promptData.history.map(event => event.publicStory).slice(-5);\n\n    // [개선] 프롬프트: 새로운 시스템을 모두 반영\n    const userPrompt = `\n      [상황 분석 요청]\n      아래 정보를 바탕으로 플레이어의 행동에 대한 결과를 생성해주십시오.\n\n      [세상의 주요 역사]\n      - ${promptData.worldHistory.length > 0 ? promptData.worldHistory.join('\\n- ') : \"특별한 역사가 기록되지 않았습니다.\"}\n      \n      [공유 컨텍스트]\n      - 현재 위치: ${promptData.sharedInfo.currentLocation}\n      - 이전 주요 사건 로그 (최대 5개): ${JSON.stringify(history)}\n      - 세상에 남겨진 흔적들: ${JSON.stringify(promptData.sharedInfo.subtleClues)}\n\n      [개인 정보 (현재 플레이어)]\n      - 직업: ${promptData.privateInfo.profession}\n      - 능력치: ${JSON.stringify(promptData.privateInfo.stats)}\n      - 인벤토리: ${JSON.stringify(promptData.privateInfo.inventory)}\n      - 활성 퀘스트: ${JSON.stringify(promptData.privateInfo.activeQuests)}\n      - 알려진 단서: ${JSON.stringify(promptData.privateInfo.knownClues)}\n      - 소속 그룹: ${JSON.stringify(promptData.privateInfo.groups)}\n      - NPC 관계도: ${JSON.stringify(promptData.privateInfo.npcRelations)}\n\n      [플레이어의 행동]\n      - 선택: \"${promptData.playerChoice}\"\n\n      [주변 플레이어]\n      - ${promptData.activeUsers.length > 0 ? JSON.stringify(promptData.activeUsers.map(u => ({ nickname: u.nickname, profession: u.profession }))) : \"현재 주변에 다른 플레이어가 없습니다.\"}\n    `;\n\n    const payload = { contents: [{ role: \"user\", parts: [{ text: systemPrompt }] }, { role: \"model\", parts: [{ text: \"{}\" }] }, { role: \"user\", parts: [{ text: userPrompt }] }] };\n\n    const tryGeminiCall = async (apiKey) => fetch(getApiUrl(apiKey), { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });\n\n    try {\n      let response = await tryGeminiCall(mainApiKey);\n      if (!response.ok) {\n        response = await tryGeminiCall(backupApiKey);\n      }\n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n      const result = await response.json();\n      const llmOutputText = result.candidates?.[0]?.content?.parts?.[0]?.text;\n      const jsonMatch = llmOutputText?.match(/\\{[\\s\\S]*\\}/);\n      if (jsonMatch) return JSON.parse(jsonMatch[0]);\n      throw new Error(\"Valid JSON object not found in LLM response.\");\n    } catch (error) {\n      console.error(\"LLM API call error:\", error);\n      setLlmError(error.message || 'LLM 호출 실패');\n      return null;\n    } finally {\n      setIsTextLoading(false);\n    }\n  };\n\n  const sendChatMessage = async () => {\n    if (!db || !userId || !isAuthReady || !currentChatMessage.trim()) return;\n    try {\n      const chatCollectionRef = collection(db, 'artifacts', appId, 'public', 'data', 'chatMessages');\n      await addDoc(chatCollectionRef, { userId, displayName: getDisplayName(userId), message: currentChatMessage, timestamp: serverTimestamp() });\n      setCurrentChatMessage('');\n    } catch (error) {\n      console.error(\"Error sending chat message:\", error);\n    }\n  };\n\n  const updatePublicState = async (llmResponse, playerChoice) => {\n      const mainScenarioRef = getMainScenarioRef(db, appId);\n      // [개선] groupStory도 이벤트 로그에 기록\n      const newEvent = {\n          actor: { id: userId, displayName: getDisplayName(userId) },\n          action: playerChoice,\n          publicStory: llmResponse.story || \"특별한 일은 일어나지 않았다.\",\n          privateStories: { [userId]: llmResponse.privateStory || null },\n          groupStory: llmResponse.groupStory || null, // 그룹 스토리 추가\n          timestamp: new Date()\n      };\n\n      await runTransaction(db, async (transaction) => {\n          const scenarioDoc = await transaction.get(mainScenarioRef);\n          if (!scenarioDoc.exists()) throw \"시나리오 문서가 없습니다.\";\n\n          const currentData = scenarioDoc.data();\n          const newStoryLog = [...(currentData.storyLog || []), newEvent];\n\n          transaction.update(mainScenarioRef, {\n              storyLog: newStoryLog,\n              choices: llmResponse.choices || [],\n              'player.currentLocation': llmResponse.sharedStateUpdates?.location || currentData.player.currentLocation,\n              // [신규] subtleClues 업데이트\n              subtleClues: llmResponse.sharedStateUpdates?.subtleClues || currentData.subtleClues,\n              lastUpdate: serverTimestamp()\n          });\n      });\n  };\n\n  const updatePrivateState = async (llmResponse) => {\n      const privateStateRef = getPrivatePlayerStateRef(db, appId, userId);\n      // [개선] groupChoices와 새로운 상태들(groups, npcRelations)도 업데이트\n      const updates = {\n        ...llmResponse.privateStateUpdates,\n        choices: [...(llmResponse.privateChoices || []), ...(llmResponse.groupChoices || [])],\n      };\n      await setDoc(privateStateRef, updates, { merge: true });\n  };\n  \n  // [신규] 선택지에 따른 행동 범위(scope)를 결정하는 헬퍼 함수\n  const getActionScope = (choice) => {\n    // 실제 구현에서는 더 정교한 파싱 로직이 필요합니다.\n    // 여기서는 예시로 '대화'는 NPC, '탐색'이나 '이동'은 장소로 가정합니다.\n    const npcMatch = choice.match(/(.+)에게 말을 건다/);\n    if (npcMatch) {\n        return `npc:${npcMatch[1].trim()}`;\n    }\n    // 더 많은 규칙 추가 가능\n    return `location:${gameState.player.currentLocation}`;\n  };\n\n  const handleChoiceClick = async (choice) => {\n    if (isTextLoading) return;\n\n    if (!privatePlayerState.characterCreated) {\n      setIsTextLoading(true);\n      const choiceKey = choice.split('.')[0];\n      const selectedProfession = professions[choiceKey];\n      if (selectedProfession) {\n          const privateStateRef = getPrivatePlayerStateRef(db, appId, userId);\n          await setDoc(privateStateRef, {\n              ...getDefaultPrivatePlayerState(),\n              characterCreated: true,\n              profession: selectedProfession.name,\n              initialMotivation: selectedProfession.motivation,\n          }, { merge: true });\n\n          const mainScenarioRef = getMainScenarioRef(db, appId);\n          const newEvent = {\n              actor: { id: userId, displayName: getDisplayName(userId) },\n              action: \"여관에 들어선다\",\n              publicStory: `어둠침침한 여관 문이 삐걱거리며 열리더니, 새로운 모험가가 모습을 드러냅니다. 바로 '${getDisplayName(userId)}'라는 이름의 ${selectedProfession.name}입니다.`,\n              privateStories: { [userId]: selectedProfession.motivation },\n              timestamp: new Date()\n          };\n\n          try {\n              await runTransaction(db, async (transaction) => {\n                  const scenarioDoc = await transaction.get(mainScenarioRef);\n                  const initialChoices = [\"여관을 둘러본다.\", \"다른 모험가에게 말을 건다.\", \"여관 주인에게 정보를 묻는다.\"];\n                  if (!scenarioDoc.exists()) {\n                      transaction.set(mainScenarioRef, { ...getDefaultGameState(), storyLog: [newEvent], choices: initialChoices, lastUpdate: serverTimestamp() });\n                  } else {\n                      const currentLog = scenarioDoc.data().storyLog || [];\n                      transaction.update(mainScenarioRef, { storyLog: [...currentLog, newEvent], choices: initialChoices, lastUpdate: serverTimestamp() });\n                  }\n              });\n          } catch (e) {\n              console.error(\"등장 이벤트 추가 실패: \", e);\n              setLlmError(\"게임 세계에 합류하는 중 오류가 발생했습니다.\");\n          } finally {\n              setIsTextLoading(false);\n          }\n      }\n      return;\n    }\n\n    const gameStatusRef = getGameStatusRef(db, appId);\n    const scope = getActionScope(choice);\n\n    setIsTextLoading(true);\n\n    try {\n        // [개선] 지역 잠금 확인 및 설정\n        const currentLocks = (await getDoc(gameStatusRef)).data()?.actionLocks || {};\n        if (currentLocks[scope] && currentLocks[scope] !== userId) {\n            throw new Error(`현재 '${scope.split(':')[1]}'(은)는 다른 플레이어(${getDisplayName(currentLocks[scope])})가 사용 중입니다.`);\n        }\n        await setDoc(gameStatusRef, { actionLocks: { ...currentLocks, [scope]: userId } }, { merge: true });\n\n        const promptData = {\n            playerChoice: choice,\n            sharedInfo: { currentLocation: gameState.player.currentLocation, subtleClues: gameState.subtleClues },\n            privateInfo: privatePlayerState,\n            history: gameState.log,\n            activeUsers: activeUsers.map(u => ({ nickname: getDisplayName(u.id), profession: u.profession })).filter(u => u.id !== userId),\n            worldHistory: worldHistory,\n        };\n\n        const llmResponse = await callGeminiTextLLM(promptData);\n\n        if (llmResponse) {\n            await updatePublicState(llmResponse, choice);\n            await updatePrivateState(llmResponse);\n            setLlmError(null);\n            setLlmRetryPrompt(null);\n        } else {\n            if (!llmError) {\n                setLlmError(\"LLM으로부터 유효한 응답을 받지 못했습니다.\");\n            }\n        }\n    } catch (error) {\n        console.error(\"행동 처리 중 오류:\", error.message);\n        setLlmError(error.message);\n    } finally {\n        // [개선] 지역 잠금 해제\n        const finalLocksDoc = await getDoc(gameStatusRef);\n        if (finalLocksDoc.exists()) {\n            const finalLocks = finalLocksDoc.data().actionLocks || {};\n            if (finalLocks[scope] === userId) { // 내가 건 잠금일 때만 해제\n                delete finalLocks[scope];\n                await setDoc(gameStatusRef, { actionLocks: finalLocks }, { merge: true });\n            }\n        }\n        setIsTextLoading(false);\n    }\n  };\n\n  const toggleAccordion = (key) => {\n    setAccordion(prev => ({ ...prev, [key]: !prev[key] }));\n  };\n\n  const LlmErrorModal = () => (\n    <div className=\"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50\">\n      <div className=\"bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-md space-y-4 text-center\">\n        <h3 className=\"text-xl font-bold text-red-400\">오류가 발생했습니다</h3>\n        <p className=\"text-gray-200\">{llmError}</p>\n        <div className=\"flex justify-center gap-4\">\n          {llmRetryPrompt && (\n            <button\n              className=\"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-md\"\n              onClick={async () => {\n                setLlmError(null);\n                if (llmRetryPrompt.playerChoice) {\n                  await handleChoiceClick(llmRetryPrompt.playerChoice);\n                }\n              }}\n            >\n              재시도\n            </button>\n          )}\n          <button\n            className=\"px-4 py-2 bg-gray-600 hover:bg-gray-700 font-bold rounded-md\"\n            onClick={() => {\n              setLlmError(null);\n              setLlmRetryPrompt(null);\n            }}\n          >\n            닫기\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n\n\n  if (showNicknameModal) {\n    return (\n        <div className=\"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50\">\n          <div className=\"bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-md space-y-4\">\n            <h3 className=\"text-xl font-bold text-gray-100\">닉네임을 입력하세요</h3>\n            <input className=\"w-full p-3 rounded-md bg-gray-700 border border-gray-600 text-gray-100 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 text-lg\" placeholder=\"닉네임\" value={nicknameInput} onChange={e => setNicknameInput(e.target.value)} onKeyDown={e => { if (e.key === 'Enter') handleNicknameSubmit(); }} autoFocus />\n            <button className=\"w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-md transition duration-300 disabled:opacity-50\" onClick={handleNicknameSubmit} disabled={!nicknameInput.trim()}>시작하기</button>\n          </div>\n        </div>\n    )\n  }\n\n  if (isLoading) {\n    return <div className=\"min-h-screen bg-gray-900 text-gray-100 flex items-center justify-center\"><div className=\"animate-spin rounded-full h-16 w-16 border-b-2 border-gray-300\"></div><span className=\"ml-4 text-xl\">데이터를 불러오는 중...</span></div>;\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-900 text-gray-100 flex flex-col items-center justify-center p-4 font-sans\">\n      {llmError && <LlmErrorModal />}\n      {showResetModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50\">\n          <div className=\"bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-md space-y-4\">\n            <h3 className=\"text-xl font-bold text-red-400\">⚠️ 모든 데이터를 초기화할까요?</h3>\n            <p className=\"text-gray-200\">이 작업은 되돌릴 수 없습니다. 모든 시나리오, 로그, 유저, 채팅 데이터가 삭제됩니다.</p>\n            <div className=\"flex justify-end gap-3\">\n              <button className=\"px-4 py-2 bg-gray-600 hover:bg-gray-700 font-bold rounded-md\" onClick={() => setShowResetModal(false)} disabled={isResetting}>취소</button>\n              <button className=\"px-4 py-2 bg-red-600 hover:bg-red-700 font-bold rounded-md\" onClick={resetAllGameData} disabled={isResetting}>{isResetting ? '초기화 중...' : '초기화'}</button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      <div className=\"w-full max-w-5xl bg-gray-800 rounded-lg shadow-xl p-6 md:p-8 flex flex-col lg:flex-row space-y-6 lg:space-y-0 lg:space-x-6\">\n        <div className=\"flex flex-col w-full lg:w-2/3 space-y-6\">\n          <div className=\"mb-2\">\n            <div className=\"flex items-center justify-between cursor-pointer select-none\" onClick={() => toggleAccordion('gameLog')}>\n              <h2 className=\"text-lg font-bold text-gray-100\">게임 로그</h2>\n              <div className=\"text-xl\">{accordion.gameLog ? '▼' : '▲'}</div>\n            </div>\n            {accordion.gameLog && (\n              <>\n                <div className=\"flex justify-end mb-2\">\n                  <button className=\"px-3 py-1 bg-red-600 hover:bg-red-700 text-white text-xs rounded-md\" onClick={() => setShowResetModal(true)}>전체 데이터 초기화</button>\n                </div>\n                <div className=\"flex-grow bg-gray-700 p-4 rounded-md overflow-y-auto h-96 custom-scrollbar text-sm md:text-base leading-relaxed\" style={{ maxHeight: '24rem' }}>\n                  {!privatePlayerState.characterCreated && (\n                    <div className=\"mb-4 p-2 rounded bg-gray-900/50 text-center\">\n                        <p className=\"text-yellow-300 font-semibold italic text-lg\">모험의 서막</p>\n                        <p className=\"whitespace-pre-wrap mt-1\">당신은 어떤 운명을 선택하시겠습니까?</p>\n                    </div>\n                  )}\n                  {gameState.log.map((event, index) => (\n                    <div key={index} className=\"mb-4 p-2 rounded bg-gray-900/50\">\n                      {event.actor?.displayName && event.action && (\n                         <p className=\"text-yellow-300 font-semibold italic text-sm\">\n                            {event.actor.displayName} 님이 {event.action} 선택\n                         </p>\n                      )}\n                      <p className=\"whitespace-pre-wrap mt-1\" dangerouslySetInnerHTML={{ __html: (event.publicStory || '').replace(/\\n/g, '<br />') }}></p>\n                      {/* [신규] 그룹 스토리 렌더링 */}\n                      {event.groupStory && privatePlayerState.groups.length > 0 && (\n                          <p className=\"whitespace-pre-wrap mt-2 p-2 rounded bg-green-900/30 border-l-4 border-green-400 text-green-200\">\n                              <span className=\"font-bold\">[그룹 이야기] </span>\n                              {event.groupStory}\n                          </p>\n                      )}\n                      {event.privateStories && event.privateStories[userId] && (\n                        <p className=\"whitespace-pre-wrap mt-2 p-2 rounded bg-blue-900/30 border-l-4 border-blue-400 text-blue-200\">\n                          <span className=\"font-bold\">[당신만 아는 사실] </span>\n                          {event.privateStories[userId]}\n                        </p>\n                      )}\n                    </div>\n                  ))}\n                  {isTextLoading && (\n                    <div className=\"flex justify-center items-center mt-4\">\n                      <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-300\"></div>\n                      <span className=\"ml-3 text-gray-400\">이야기를 생성 중...</span>\n                    </div>\n                  )}\n                  {/* [개선] 지역 잠금 메시지 표시 */}\n                  {Object.entries(actionLocks).map(([scope, lockedBy]) => {\n                    if (lockedBy === userId) return null; // 내가 건 잠금은 표시 안함\n                    return (\n                        <div key={scope} className=\"text-center text-yellow-400 font-semibold p-2 bg-black bg-opacity-20 rounded-md mt-2\">\n                            {`'${scope.split(':')[1]}' 영역은 ${getDisplayName(lockedBy)}님이 사용 중입니다...`}\n                        </div>\n                    )\n                  })}\n                  <div ref={logEndRef} />\n                </div>\n              </>\n            )}\n          </div>\n\n          <div className=\"flex flex-col gap-3\">\n              {privatePlayerState.characterCreated ? (\n                  [...gameState.choices, ...(privatePlayerState.choices || [])].map((choice, index) => {\n                      // [개선] 선택지 버튼 로직: 지역 잠금 및 그룹 선택지 구분\n                      const scope = getActionScope(choice);\n                      const isLockedByOther = actionLocks[scope] && actionLocks[scope] !== userId;\n                      const allPrivateChoices = privatePlayerState.choices || [];\n                      const isPersonalChoice = allPrivateChoices.includes(choice);\n                      const isPublicChoice = gameState.choices.includes(choice);\n                      \n                      let buttonStyle = 'bg-blue-600 hover:bg-blue-700'; // Public\n                      let prefix = '';\n\n                      if (isPersonalChoice && !isPublicChoice) {\n                        buttonStyle = 'bg-green-600 hover:bg-green-700'; // Group/Private\n                        prefix = '[개인/그룹] ';\n                      }\n                      \n                      if (isLockedByOther) {\n                        buttonStyle = 'bg-gray-500 cursor-not-allowed';\n                        prefix = `[${getDisplayName(actionLocks[scope])} 사용 중] `;\n                      }\n\n                      return (\n                          <button\n                              key={index}\n                              className={`px-6 py-3 font-bold rounded-md shadow-lg transition duration-300 disabled:opacity-50 ${buttonStyle} text-white`}\n                              onClick={() => handleChoiceClick(choice)}\n                              disabled={isTextLoading || isLockedByOther}\n                          >\n                              {prefix}{choice}\n                          </button>\n                      )\n                  })\n              ) : (\n                  Object.keys(professions).map(key => (\n                      <button\n                          key={key}\n                          onClick={() => handleChoiceClick(`${key}. ${professions[key].name}`)}\n                          disabled={isTextLoading}\n                          className=\"px-6 py-4 bg-gray-800 hover:bg-gray-700 border border-gray-600 text-white font-bold rounded-md shadow-lg transition duration-300 disabled:opacity-50 disabled:cursor-wait text-left\"\n                      >\n                          <p className=\"text-lg text-blue-300\">{`${key}. ${professions[key].name}`}</p>\n                          <p className=\"text-sm font-normal text-gray-300 mt-1\">{professions[key].motivation}</p>\n                      </button>\n                  ))\n              )}\n          </div>\n        </div>\n\n        <div className=\"w-full lg:w-1/3 flex flex-col space-y-6 bg-gray-700 p-4 rounded-lg shadow-inner\">\n            <div className=\"mb-2\">\n                <div className=\"flex items-center justify-between cursor-pointer select-none\" onClick={() => toggleAccordion('playerInfo')}>\n                    <h4 className=\"text-md font-semibold text-gray-200\">내 정보</h4>\n                    <div className=\"text-xl\">{accordion.playerInfo ? '▼' : '▲'}</div>\n                </div>\n                {accordion.playerInfo && (\n                  // [개선] 내 정보 UI에 신규 기능 반영\n                  <div className=\"bg-gray-600 p-3 rounded-md text-xs md:text-sm text-gray-300 space-y-1 h-48 overflow-y-auto custom-scrollbar\">\n                    <p><span className=\"font-semibold text-blue-300\">이름:</span> {getDisplayName(userId)}</p>\n                    <p><span className=\"font-semibold text-blue-300\">직업:</span> {privatePlayerState.profession || '미정'}</p>\n                    <p><span className=\"font-semibold text-blue-300\">위치:</span> {gameState.player.currentLocation}</p>\n                    <p><span className=\"font-semibold text-blue-300\">능력치:</span> 힘({privatePlayerState.stats.strength}) 지능({privatePlayerState.stats.intelligence}) 민첩({privatePlayerState.stats.agility}) 카리스마({privatePlayerState.stats.charisma})</p>\n                    <p><span className=\"font-semibold text-blue-300\">인벤토리:</span> {privatePlayerState.inventory.join(', ') || '비어있음'}</p>\n                    <p><span className=\"font-semibold text-blue-300\">퀘스트:</span> {privatePlayerState.activeQuests.join(', ') || '없음'}</p>\n                    <p><span className=\"font-semibold text-blue-300\">단서:</span> {privatePlayerState.knownClues.join(', ') || '없음'}</p>\n                    <p><span className=\"font-semibold text-green-300\">소속 그룹:</span> {privatePlayerState.groups.join(', ') || '없음'}</p>\n                    <div>\n                        <span className=\"font-semibold text-yellow-300\">NPC 관계:</span>\n                        <ul className=\"list-disc list-inside ml-4\">\n                            {Object.entries(privatePlayerState.npcRelations).length > 0 ? \n                                Object.entries(privatePlayerState.npcRelations).map(([name, value]) => <li key={name}>{`${name}: ${value}`}</li>) :\n                                <li>알려진 관계 없음</li>\n                            }\n                        </ul>\n                    </div>\n                  </div>\n                )}\n            </div>\n            <div className=\"mb-2\">\n                <div className=\"flex items-center justify-between cursor-pointer select-none\" onClick={() => toggleAccordion('users')}>\n                    <h4 className=\"text-md font-semibold text-gray-200\">현재 플레이어들</h4>\n                    <div className=\"text-xl\">{accordion.users ? '▼' : '▲'}</div>\n                </div>\n                {accordion.users && (\n                    <div className=\"bg-gray-600 p-3 rounded-md h-48 overflow-y-auto custom-scrollbar\">\n                        {activeUsers.length > 0 ? (\n                            <ul className=\"text-sm text-gray-300 space-y-1\">\n                                {activeUsers.map(user => (\n                                    <li key={user.id} className=\"truncate p-1 rounded-md\">\n                                        <span className=\"font-medium text-green-300\">{getDisplayName(user.id)}</span>\n                                        <span className=\"text-gray-400 text-xs\"> ({user.profession || '모험가'})</span>\n                                    </li>\n                                ))}\n                            </ul>\n                        ) : <p className=\"text-sm text-gray-400\">활동 중인 플레이어가 없습니다.</p>}\n                    </div>\n                )}\n            </div>\n            <div className=\"mb-2\">\n                <div className=\"flex items-center justify-between cursor-pointer select-none\" onClick={() => toggleAccordion('chat')}>\n                    <h4 className=\"text-md font-semibold text-gray-200\">공개 채팅</h4>\n                    <div className=\"text-xl\">{accordion.chat ? '▼' : '▲'}</div>\n                </div>\n                {accordion.chat && (\n                    <div className=\"bg-gray-600 p-3 rounded-md flex flex-col h-64\">\n                        <div className=\"flex-grow overflow-y-auto custom-scrollbar mb-3 text-sm space-y-2\">\n                            {chatMessages.map((msg) => (\n                                <div key={msg.id}><p><span className=\"font-medium text-yellow-300\">{getDisplayName(msg.userId)}:</span> {msg.message}</p></div>\n                            ))}\n                            <div ref={chatEndRef} />\n                        </div>\n                        <div className=\"flex\">\n                            <input type=\"text\" className=\"flex-grow p-2 rounded-l-md bg-gray-700 border border-gray-600\" value={currentChatMessage} onChange={(e) => setCurrentChatMessage(e.target.value)} onKeyPress={(e) => e.key === 'Enter' && sendChatMessage()} disabled={!isAuthReady} />\n                            <button className=\"px-4 py-2 bg-blue-600 hover:bg-blue-700 font-bold rounded-r-md\" onClick={sendChatMessage} disabled={!isAuthReady || !currentChatMessage.trim()}>보내기</button>\n                        </div>\n                    </div>\n                )}\n            </div>\n        </div>\n      </div>\n\n      <style>\n        {`\n        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap');\n        body { font-family: 'Noto Sans KR', sans-serif; }\n        .custom-scrollbar::-webkit-scrollbar { width: 8px; }\n        .custom-scrollbar::-webkit-scrollbar-track { background: #4a5568; border-radius: 10px; }\n        .custom-scrollbar::-webkit-scrollbar-thumb { background: #6b7280; border-radius: 10px; }\n        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #9ca3af; }\n        `}\n      </style>\n    </div>\n  );\n}\n\nexport default App;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}